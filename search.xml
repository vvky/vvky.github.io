<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åŸºäºflaskå’Œesçš„æ—¥å¿—ç³»ç»Ÿ</title>
      <link href="/2024/05/17/%E5%9F%BA%E4%BA%8Eflask%E5%92%8Ces%E7%9A%84%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/"/>
      <url>/2024/05/17/%E5%9F%BA%E4%BA%8Eflask%E5%92%8Ces%E7%9A%84%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒè¦æ±‚"><a href="#ç¯å¢ƒè¦æ±‚" class="headerlink" title="ç¯å¢ƒè¦æ±‚"></a>ç¯å¢ƒè¦æ±‚</h2><p>python3.8ã€flask2.3ã€elasticsearch8.13</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask==2.3</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install elasticsearch==8.13</span><br></pre></td></tr></table></figure><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p><code>tools/es_logger.py</code> esæ—¥å¿—å·¥å…·ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time, psutil</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> tools.es_client <span class="keyword">import</span> CustomEsClient</span><br><span class="line"></span><br><span class="line">es = CustomEsClient()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElasticsearchLogger</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, es_client, index</span>):</span><br><span class="line">        self.es_client = es_client</span><br><span class="line">        self.index = index</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> es.indices.exists(index=index):</span><br><span class="line">            es.indices.create(index=index, ignore=<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_document</span>(<span class="params">self, request_id, remote_addr, request_url, path, method, headers, args, body, form</span>):</span><br><span class="line">        doc = &#123;</span><br><span class="line">            <span class="string">&#x27;@timestamp&#x27;</span>: <span class="built_in">int</span>(time.time()) * <span class="number">1000</span>,</span><br><span class="line">            <span class="string">&#x27;request_id&#x27;</span>: request_id,</span><br><span class="line">            <span class="string">&#x27;address&#x27;</span>: remote_addr,</span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>: request_url,</span><br><span class="line">            <span class="string">&#x27;path&#x27;</span>: path,</span><br><span class="line">            <span class="string">&#x27;method&#x27;</span>: method,</span><br><span class="line">            <span class="string">&#x27;headers&#x27;</span>: <span class="built_in">dict</span>(headers),</span><br><span class="line">            <span class="string">&#x27;args&#x27;</span>: <span class="built_in">dict</span>(args),</span><br><span class="line">            <span class="string">&#x27;body&#x27;</span>: body <span class="keyword">if</span> body <span class="keyword">else</span> &#123;&#125;,</span><br><span class="line">            <span class="string">&#x27;form&#x27;</span>: <span class="built_in">dict</span>(form),</span><br><span class="line">            <span class="string">&#x27;logs&#x27;</span>: [],</span><br><span class="line">            <span class="string">&#x27;system&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;free_memory&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;psutil.virtual_memory().available / <span class="number">1024</span> / <span class="number">1024</span> / <span class="number">1024</span>&#125;</span> GB&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;free_disk&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;psutil.disk_usage(<span class="string">&#x27;/&#x27;</span>).free / <span class="number">1024</span> / <span class="number">1024</span> / <span class="number">1024</span>&#125;</span> GB&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;current_hostname&#x27;</span>: psutil.users()[<span class="number">0</span>].name</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        self.es_client.index(index=self.index, <span class="built_in">id</span>=request_id, body=doc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_message</span>(<span class="params">self, request_id, message, level=<span class="string">&#x27;INFO&#x27;</span></span>):</span><br><span class="line">        logger.debug(<span class="string">f&quot;Request <span class="subst">&#123;request_id&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">        log_entry = &#123;</span><br><span class="line">            <span class="string">&#x27;@timestamp&#x27;</span>: datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: level,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: message</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        self.es_client.update(index=self.index, <span class="built_in">id</span>=request_id, body=&#123;</span><br><span class="line">            <span class="string">&#x27;script&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;ctx._source.logs.add(params.log_entry)&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;lang&#x27;</span>: <span class="string">&#x27;painless&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;params&#x27;</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;log_entry&#x27;</span>: log_entry</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_index = <span class="string">f&#x27;flask-logs-<span class="subst">&#123;datetime.now().strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)&#125;</span>&#x27;</span></span><br><span class="line">es_logger = ElasticsearchLogger(es, _index)</span><br></pre></td></tr></table></figure><p><code>flask appå±‚</code>ï¼Œä½¿ç”¨é’©å­å‡½æ•°ï¼Œå®ç°è¯·æ±‚å‰åè°ƒç”¨æ—¥å¿—å¤„ç†å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> tools.es_logger <span class="keyword">import</span> es_logger</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, g</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_request</span>():</span><br><span class="line">    g.request_id = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line">    es_logger.create_document(g.request_id, request.remote_addr, request.url, request.path, request.method,</span><br><span class="line">                              request.headers, request.args, request.json, request.form)</span><br><span class="line">    es_logger.log_message(g.request_id, <span class="string">&#x27;ä¸Šè¡Œæ¥å£ è¯·æ±‚å¼€å§‹&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">end_request</span>(<span class="params">response</span>):</span><br><span class="line">    es_logger.log_message(g.request_id, <span class="string">&#x27;ä¸Šè¡Œæ¥å£ è¯·æ±‚ç»“æŸ&#x27;</span>, response.status_code)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> g</span><br><span class="line">es_logger.log_message(g.request_id, <span class="string">&quot;å¿ƒè·³æ—¥å¿—ä¿å­˜æˆåŠŸ&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="æ—¥å¿—æ•ˆæœ"><a href="#æ—¥å¿—æ•ˆæœ" class="headerlink" title="æ—¥å¿—æ•ˆæœ"></a>æ—¥å¿—æ•ˆæœ</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;flask-logs-2024-05-16&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fcc0f207-54e8-4405-afd5-89b6fadcc301&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_score&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="number">1715850961000</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;request_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fcc0f207-54e8-4405-afd5-89b6fadcc301&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://127.0.0.1:19899/api/v1/terminals/gateway&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/api/v1/terminals/gateway&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;headers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;User-Agent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Content-Type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;application/json&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Accept&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Cache-Control&quot;</span><span class="punctuation">:</span> <span class="string">&quot;no-cache&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Postman-Token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;08f7e379-d39e-48ed-a1f0-468e3f00318a&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1:19899&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Accept-Encoding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gzip, deflate, br&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Connection&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keep-alive&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Content-Length&quot;</span><span class="punctuation">:</span> <span class="string">&quot;553&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;messageHeader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;terminalPhoneNumber&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18832301609&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;messageId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;register&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;messageSerialNumber&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;messageBody&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;terminalModel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RCM-BK6MZJ&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;vehicleIdentifier&quot;</span><span class="punctuation">:</span> <span class="string">&quot;äº¬a12345&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;manufacturerId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;44030&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;terminalId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;w12345678&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;provinceId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;cityCountyId&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;plateColor&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0100002d018832301609000100000000343430333052434d2d424b364d5a4a000000000000000000007731323334353600bea9613132333435ae7e&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;checkCode&quot;</span><span class="punctuation">:</span> <span class="number">45</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;form&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;logs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸Šè¡Œæ¥å£ è¯·æ±‚å¼€å§‹&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SUCCESS&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç½‘å…³åˆå§‹åŒ–æˆåŠŸï¼&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ¶ˆæ¯IDæ ¡éªŒé€šè¿‡ï¼register&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¼€å§‹å¤„ç†æ¶ˆæ¯ï¼register&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç»ˆç«¯æ³¨å†Œè¯·æ±‚ä½“ï¼š&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ­£åœ¨æ ¡éªŒç»ˆç«¯æ³¨å†Œä¿¡æ¯ï¼&#123;&#x27;query&#x27;: &#123;&#x27;bool&#x27;: &#123;&#x27;must&#x27;: [&#123;&#x27;match&#x27;: &#123;&#x27;messageBody.terminalId&#x27;: &#x27;w12345678&#x27;&#125;&#125;]&#125;&#125;&#125;&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å“åº”æ¶ˆæ¯ï¼šç»ˆç«¯æ³¨å†Œå¤±è´¥ï¼ç»ˆç«¯IDå·²å­˜åœ¨ï¼w12345678 å¼‚å¸¸ä¿¡æ¯ï¼šNone å“åº”æ•°æ®ï¼š&#123;&#x27;message&#x27;: &#x27;ç»ˆç«¯æ³¨å†Œå¤±è´¥ï¼ç»ˆç«¯IDå·²å­˜åœ¨ï¼w12345678&#x27;, &#x27;code&#x27;: 0, &#x27;requestId&#x27;: &#x27;fcc0f207-54e8-4405-afd5-89b6fadcc301&#x27;, &#x27;content&#x27;: &#123;&#x27;responseSerialNumber&#x27;: 1, &#x27;authenticationCode&#x27;: &#x27;&#x27;, &#x27;result&#x27;: &#x27;1&#x27;&#125;&#125;&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å“åº”æ¶ˆæ¯ï¼šä¸Šè¡Œç½‘å…³å“åº”æˆåŠŸï¼ å¼‚å¸¸ä¿¡æ¯ï¼šNone å“åº”æ•°æ®ï¼š&#123;&#x27;message&#x27;: &#x27;ä¸Šè¡Œç½‘å…³å“åº”æˆåŠŸï¼&#x27;, &#x27;code&#x27;: None, &#x27;requestId&#x27;: &#x27;fcc0f207-54e8-4405-afd5-89b6fadcc301&#x27;, &#x27;content&#x27;: &#123;&#x27;message&#x27;: &#x27;ç»ˆç«¯æ³¨å†Œå¤±è´¥ï¼ç»ˆç«¯IDå·²å­˜åœ¨ï¼w12345678&#x27;, &#x27;code&#x27;: 0, &#x27;requestId&#x27;: &#x27;fcc0f207-54e8-4405-afd5-89b6fadcc301&#x27;, &#x27;content&#x27;: &#123;&#x27;responseSerialNumber&#x27;: 1, &#x27;authenticationCode&#x27;: &#x27;&#x27;, &#x27;result&#x27;: &#x27;1&#x27;&#125;&#125;&#125;&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-05-16 17:16:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸Šè¡Œæ¥å£ è¯·æ±‚ç»“æŸ&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;system&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;free_memory&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.1894683837890625 GB&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;free_disk&quot;</span><span class="punctuation">:</span> <span class="string">&quot;133.49493408203125 GB&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;current_hostname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wangkaiyu&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonè‡ªå®šä¹‰åˆå§‹åŒ–æ“ä½œ</title>
      <link href="/2024/05/14/python%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C/"/>
      <url>/2024/05/14/python%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>ç”¨pythoné¿å…ä¸äº†å„ç§æ¶å¿ƒçš„å¯¼åŒ…è·¯å¾„é—®é¢˜æˆ–å­—ç¬¦ç¼–ç é—®é¢˜ï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¯åœ¨pythonè§£é‡Šå™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚ </p><p>åœ¨<code>site-packages</code>ç›®å½•ä¸‹åˆ›å»º<code>sitecustomize.py</code>æ–‡ä»¶ï¼Œæ·»åŠ è‡ªå®šä¹‰æ“ä½œï¼Œå¦‚:</p><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>Miniconda</code>ï¼Œ<code>site-packages</code>ç›®å½•åœ¨<code>/root/miniconda3/lib/python3.12/site-packages</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">&quot;/home/wangkaiyu/test&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜¿é‡Œäº‘OSSä¸Šä¼ å›è°ƒ</title>
      <link href="/2024/04/26/%E9%98%BF%E9%87%8C%E4%BA%91OSS%E4%B8%8A%E4%BC%A0%E5%9B%9E%E8%B0%83/"/>
      <url>/2024/04/26/%E9%98%BF%E9%87%8C%E4%BA%91OSS%E4%B8%8A%E4%BC%A0%E5%9B%9E%E8%B0%83/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">__doc__ = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ğŸ¤®ğŸ¤®ğŸ¤® é˜¿é‡Œäº‘çš„å„ç§æ–‡æ¡£æ˜¯çœŸå‚»é€¼ï¼Œç‰›å¤´ä¸å¯¹é©¬å˜´ã€‚</span></span><br><span class="line"><span class="string">ä¸‹é¢æ¼”ç¤ºâ€˜put_objectâ€™ä¸Šä¼ æ¥å£çš„å›è°ƒåŠŸèƒ½ã€‚(&#x27;put_object_from_file&#x27;ä¹Ÿå±äº&#x27;PutObject&#x27;)</span></span><br><span class="line"><span class="string">è¯¥æ–¹æ³•é€‚ç”¨äºå‰ç«¯ä¸Šä¼ æ–‡ä»¶å¯¹æ¥é˜¿é‡Œäº‘ï¼Œé˜¿é‡Œäº‘æŠŠæ–‡ä»¶ä¿¡æ¯å›è°ƒç»™æœåŠ¡ç«¯è½åº“å­˜å‚¨ã€‚</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> oss2</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»ç¯å¢ƒå˜é‡æå–æ•æ„Ÿé…ç½®ç¡®å®æ˜¯å¥½ä¹ æƒ¯ï¼Œå› ä¸ºæˆ‘çš„macbookä¿®æ”¹äº†é»˜è®¤bashï¼Œè¿™é‡Œè¦å…ˆä»ohmyzshä¸­åŠ è½½ç¯å¢ƒå˜é‡åˆ°é»˜è®¤çš„envä¸­</span></span><br><span class="line">hostname = socket.gethostname()</span><br><span class="line"><span class="keyword">if</span> hostname == <span class="string">&quot;DESKTOP-14.local&quot;</span>:</span><br><span class="line">    result = subprocess.run(</span><br><span class="line">        [<span class="string">&quot;/bin/zsh&quot;</span>, <span class="string">&quot;-i&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;source ~/.zshrc.pre-oh-my-zsh &amp;&amp; env&quot;</span>],</span><br><span class="line">        capture_output=<span class="literal">True</span>,</span><br><span class="line">        text=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> result.stdout.splitlines():</span><br><span class="line">        key, value = line.split(<span class="string">&quot;=&quot;</span>, <span class="number">1</span>)</span><br><span class="line">        os.environ[key] = value</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€å¥½ä½¿ç”¨ä¸€ä¸ªé˜¿é‡Œäº‘å­è´¦æˆ·çš„access_key_idå’Œaccess_key_secret</span></span><br><span class="line">access_key_id = os.getenv(<span class="string">&#x27;OSS_ACCESS_KEY_ID&#x27;</span>, <span class="string">&#x27;&lt;AccessKeyId&gt;&#x27;</span>)</span><br><span class="line">access_key_secret = os.getenv(<span class="string">&#x27;OSS_ACCESS_KEY_SECRET&#x27;</span>, <span class="string">&#x27;&lt;AccessKeySecret&gt;&#x27;</span>)</span><br><span class="line">bucket_name = os.getenv(<span class="string">&#x27;OSS_BUCKET_NAME&#x27;</span>, <span class="string">&#x27;vvky&#x27;</span>)</span><br><span class="line"><span class="comment"># æ³¨æ„æ˜¯http!</span></span><br><span class="line">endpoint = <span class="string">&#x27;http://oss-cn-beijing.aliyuncs.com&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ä¸€ä¸‹ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> (access_key_id, access_key_secret, bucket_name, endpoint):</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;&lt;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> param, <span class="string">&#x27;ç¯å¢ƒå˜é‡ç¼ºå¤±ï¼&#x27;</span> + param</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬æ¬¡æµ‹è¯•çš„æ–‡ä»¶ï¼Œput_objectæ¥å£æ”¯æŒè¿™ç§ç›´æ¥å‘½å+æŒ‡å®šå†…å®¹çš„æ–¹å¼</span></span><br><span class="line">key = <span class="string">&#x27;test.txt&#x27;</span></span><br><span class="line">content = <span class="string">&quot;è«é“çŸ³äººä¸€åªçœ¼ï¼ŒæŒ‘åŠ¨é»„æ²³å¤©ä¸‹å&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾—åˆ°æ–‡æœ¬md5ï¼Œæ³¨æ„é˜¿é‡Œäº‘ossçš„utils.content_md5è¿”å›çš„æ˜¯b64ç¼–ç åçš„å­—ç¬¦ä¸²ï¼é‡Œé¢è¿˜æœ‰å¾ˆå¤šå¥½ç©çš„å·¥å…·å‡½æ•°</span></span><br><span class="line">content_md5 = oss2.utils.content_md5(content)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ä¸Šä¼ æ–‡ä»¶çš„b64(md5)æ˜¯: <span class="subst">&#123;content_md5&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºbucketå¯¹è±¡ï¼Œæ‰€æœ‰é’ˆå¯¹objectçš„APIéƒ½å¯ä»¥é€šè¿‡bucketå¯¹è±¡æ¥è°ƒç”¨</span></span><br><span class="line">bucket = oss2.Bucket(oss2.Auth(access_key_id, access_key_secret), endpoint, bucket_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºå›è°ƒå‚æ•°ï¼Œæ–‡æ¡£ï¼š https://help.aliyun.com/document_detail/31989.html</span></span><br><span class="line">callback_dict = &#123;</span><br><span class="line">    <span class="comment"># è¿™ç©æ„æ­»æ´»ä¸å¥½ä½¿ï¼Œåæ­£ä¹Ÿç”¨ä¸åˆ°</span></span><br><span class="line">    <span class="comment"># callback_dict[&#x27;callbackHost&#x27;] = &#x27;43.140.212.195:8899&#x27;,</span></span><br><span class="line">    <span class="comment"># å›è°ƒæ¥å£ï¼Œå¿…é¡»ä¸ºPOSTï¼Œæ”¯æŒhttp/httpsï¼Œæ­¤å¤„å†™çš„æ˜¯æˆ‘çš„è…¾è®¯äº‘ä¸´æ—¶æ¥å£</span></span><br><span class="line">    <span class="string">&#x27;callbackUrl&#x27;</span>: <span class="string">&#x27;http://43.140.212.195:8899/test&#x27;</span>,</span><br><span class="line">    <span class="comment"># éƒ¨åˆ†å›è°ƒå‚æ•°é‡Šä¹‰ï¼š</span></span><br><span class="line">    <span class="comment">#     contentMd5ï¼šä¸Šä¼ æ–‡ä»¶çš„MD5å€¼</span></span><br><span class="line">    <span class="comment">#     imageInfo.formatï¼šå›¾ç‰‡æ ¼å¼</span></span><br><span class="line">    <span class="comment">#     objectï¼šå¯¹è±¡ï¼ˆæ–‡ä»¶ï¼‰çš„å®Œæ•´è·¯å¾„ã€‚ï¼ˆoss file nameï¼‰</span></span><br><span class="line">    <span class="comment">#     bucketï¼šä¸Šä¼ æ–‡ä»¶çš„bucket</span></span><br><span class="line">    <span class="comment">#     sizeï¼šä¸Šä¼ çš„Objectå¤§å°</span></span><br><span class="line">    <span class="comment">#     mimeTypeï¼šä¸Šä¼ æ–‡ä»¶çš„èµ„æºç±»å‹</span></span><br><span class="line">    <span class="comment">#     clientIpï¼šå‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯IPåœ°å€</span></span><br><span class="line">    <span class="comment">#     reqIdï¼šå‘èµ·è¯·æ±‚çš„RequestId</span></span><br><span class="line">    <span class="comment">#     operationï¼šæ“ä½œç±»å‹ï¼ŒPutObject</span></span><br><span class="line">    <span class="comment"># ä¸¤ç§å†™æ³•ï¼š</span></span><br><span class="line">    <span class="comment"># form-urlencoded</span></span><br><span class="line">    <span class="string">&#x27;callbackBody&#x27;</span>: <span class="string">&#x27;operation=$&#123;operation&#125;&amp;clientIp=$&#123;clientIp&#125;&amp;contentMd5=$&#123;contentMd5&#125;&amp;imageInfo.format=$&#123;imageInfo.format&#125;&amp;object=$&#123;object&#125;&amp;bucket=$&#123;bucket&#125;&amp;object=$&#123;object&#125;&amp;size=$&#123;size&#125;&amp;mimeType=$&#123;mimeType&#125;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;callbackBodyType&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">    <span class="comment"># json</span></span><br><span class="line">    <span class="comment"># &quot;callbackBody&quot;:&quot;&#123;\&quot;mimeType\&quot;:$&#123;mimeType&#125;,\&quot;size\&quot;:$&#123;size&#125;&#125;&quot;,</span></span><br><span class="line">    <span class="comment"># &#x27;callbackBodyType&#x27;: &#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡ç‚¹ï¼šå›è°ƒå‚æ•°æ˜¯jsonæ ¼å¼ï¼Œå¹¶b64ç¼–ç </span></span><br><span class="line">callback_param = json.dumps(callback_dict).strip()</span><br><span class="line">base64_callback_body = oss2.utils.b64encode_as_string(callback_param)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›è°ƒå‚æ•°ç¼–ç åæ”¾åœ¨headersä¸­</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;x-oss-callback&#x27;</span>: base64_callback_body&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¦ä¸Šheadersä¸Šä¼ ï¼Œå³å¯è§¦å‘å›è°ƒ</span></span><br><span class="line">result = bucket.put_object(key, content, headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šä¸Šä¼ å¹¶å›è°ƒæˆåŠŸstatus==200ï¼Œä¸Šä¼ æˆåŠŸä½†å›è°ƒå¤±è´¥status==203</span></span><br><span class="line"><span class="keyword">if</span> result.status == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä¸Šä¼ æ–‡ä»¶æˆåŠŸï¼<span class="subst">&#123;result.status&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> result.status == <span class="number">203</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä¸Šä¼ æ–‡ä»¶æˆåŠŸä½†å›è°ƒå¤±è´¥ï¼<span class="subst">&#123;result.status&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ä¸Šä¼ æ–‡ä»¶å¤±è´¥ï¼<span class="subst">&#123;result.status&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥åœ¨respä¸­æ£€æŸ¥å›è°ƒæœåŠ¡çš„å“åº”ç»“æœ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;å›è°ƒæœåŠ¡çš„å“åº”ç»“æœ: <span class="subst">&#123;result.resp.read()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># assert result.resp.read() != &#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼Œhead_object ç”¨äºè·å–æ–‡ä»¶å…ƒä¿¡æ¯ï¼Œè¿˜è®°å¾—keyå—ï¼Œå°±æ˜¯ä¸Šé¢çš„æ–‡ä»¶å</span></span><br><span class="line">result = bucket.head_object(key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤åˆšåˆšä¸Šä¼ çš„æµ‹è¯•æ–‡ä»¶ï¼Œä½¿ç”¨delete_objectï¼Œæ›´å¤šç”¨æ³•å»æºç é‡Œçœ‹ï¼Œå†™çš„å¾ˆä¸é”™ã€‚</span></span><br><span class="line">bucket.delete_object(key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æµ‹è¯•æ–‡ä»¶å·²åˆ é™¤ï¼<span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># OKäº†ï¼Œä½ å·²ç»æŒæ¡ossçš„ä¸Šä¼ å›è°ƒäº†ã€‚</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ğŸ‚ğŸº&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> OSS </tag>
            
            <tag> Python </tag>
            
            <tag> é˜¿é‡Œäº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³é—­ESè­¦å‘Š</title>
      <link href="/2024/04/26/%E5%85%B3%E9%97%ADES%E8%AD%A6%E5%91%8A/"/>
      <url>/2024/04/26/%E5%85%B3%E9%97%ADES%E8%AD%A6%E5%91%8A/</url>
      
        <content type="html"><![CDATA[<p>esæ€»æç¤ºè¿™æ¡è­¦å‘Š</p><blockquote><p>â€œElasticsearch built-in security features are not enabled. Without authentication, your cluster could be accessible to<br>anyone. See <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.13/security-minimal-setup.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.13/security-minimal-setup.html</a> to enable<br>security.â€</p></blockquote><h3 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h3><p>æ˜¯æœªé…ç½®å®‰å…¨æ’ä»¶çš„è­¦å‘Šï¼Œåœ¨<code>elasticsearch.yml</code>å…³é—­<code>xpack.security.enabled</code>å³å¯</p><h4 id="æŸ¥çœ‹å½“å‰å®¹å™¨"><a href="#æŸ¥çœ‹å½“å‰å®¹å™¨" class="headerlink" title="æŸ¥çœ‹å½“å‰å®¹å™¨"></a>æŸ¥çœ‹å½“å‰å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS                                              NAMES</span><br><span class="line">57871902f4a4        java-16.45             &quot;java -jar app.jar&quot;      7 weeks ago         Up 7 weeks          0.0.0.0:8899-&gt;8899/tcp                             java-16.45</span><br><span class="line">843c605b7aaa        elasticsearch:7.13.2   &quot;/bin/tini -- /usr...&quot;   8 weeks ago         Up 5 minutes        0.0.0.0:19399-&gt;9200/tcp, 0.0.0.0:19398-&gt;9300/tcp   es</span><br></pre></td></tr></table></figure><h4 id="è¿›å…¥å®¹å™¨"><a href="#è¿›å…¥å®¹å™¨" class="headerlink" title="è¿›å…¥å®¹å™¨"></a>è¿›å…¥å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it 843c605b7aaa /bin/bash</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi config/elasticsearch.yml</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xpack.security.enabled: false</span><br></pre></td></tr></table></figure><h4 id="é‡å¯å®¹å™¨"><a href="#é‡å¯å®¹å™¨" class="headerlink" title="é‡å¯å®¹å™¨"></a>é‡å¯å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart 843c605b7aaa</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonçš„Elasticsearchæ— æ³•è¿æ¥ES</title>
      <link href="/2024/04/24/Python%E7%9A%84Elasticsearch%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5ES/"/>
      <url>/2024/04/24/Python%E7%9A%84Elasticsearch%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5ES/</url>
      
        <content type="html"><![CDATA[<p>python3.9</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;192.168.1.165&#x27;</span></span><br><span class="line">port = <span class="number">19399</span></span><br><span class="line">es = Elasticsearch([&#123;<span class="string">&#x27;host&#x27;</span>: host, <span class="string">&#x27;port&#x27;</span>: port, <span class="string">&#x27;scheme&#x27;</span>: <span class="string">&#x27;http&#x27;</span>&#125;])</span><br><span class="line"><span class="built_in">print</span>(es.ping())</span><br></pre></td></tr></table></figure><p>å¤¸å¤¸æŠ¥é”™ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch.UnsupportedProductError: </span><br><span class="line">The client noticed that the server is not Elasticsearch and we do not support </span><br></pre></td></tr></table></figure><p>ä½†æ˜¯requestså´å¯ä»¥è®¿é—®<code>http://192.168.1.165:19399/</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;843c605b7aaa&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker-cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Tzo9vQLTQ-eHosFP0LrqyQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.13.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_flavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_hash&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4d960a0733be83dd2543ca018aa4ddc42e956800&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-06-10T21:01:55.251515791Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_snapshot&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lucene_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.8.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_wire_compatibility_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6.8.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_index_compatibility_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tagline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å‘ç°<code>ES</code>ç‰ˆæœ¬æ˜¯<code>7.13.2</code>ï¼ŒæŸ¥çœ‹<code>Python Elasticsearch</code>çš„ç‰ˆæœ¬ï¼Œæ˜¯ä»–å¦ˆ<code>8.13.0</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip show elasticsearch</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Name: elasticsearch</span><br><span class="line">Version: 8.13.0</span><br><span class="line">Summary: Python client for Elasticsearch</span><br><span class="line">Home-page: https://github.com/elastic/elasticsearch-py</span><br><span class="line">Author: Elastic Client Library Maintainers</span><br><span class="line">Author-email: client-libs@elastic.co</span><br><span class="line">License: Apache-2.0</span><br><span class="line">Location: /Users/wangkaiyu/Documents/ä¸ªäººç»ƒä¹ /practice/miniconda3/lib/python3.11/site-packages</span><br><span class="line">Requires: elastic-transport</span><br><span class="line">Required-by: </span><br></pre></td></tr></table></figure><p>åŸå› ï¼špythonçš„esåŒ…å’Œ<code>ES</code>çš„ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œè¦ä¿æŒå¤§ç‰ˆæœ¬ä¸€è‡´ã€‚ï¼ˆ7.13.1ä¹Ÿå¯ä»¥ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install elasticsearch==7.13.2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tcp socketå›å¿†å½•</title>
      <link href="/2024/04/24/tcp%20socket%E5%9B%9E%E5%BF%86%E5%BD%95/"/>
      <url>/2024/04/24/tcp%20socket%E5%9B%9E%E5%BF%86%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‡ å¤©æ¥äº†ä¸€ä¸ªtcp&#x2F;udpç³»ç»Ÿé›†æˆçš„éœ€æ±‚ï¼Œæ­»å»çš„çŸ¥è¯†å¼€å§‹æ”»å‡»æˆ‘ã€‚<br>å¤§äºŒæ—¶å­¦è¿™ç©æ„ï¼Œç”¨ç±»ä¼¼äºä¸‹å›¾çš„è¿™ä¸ªå®¢æˆ·ç«¯å·¥å…·ï¼Œåœ¨å±€åŸŸç½‘å†…ç»ƒä¹ äº’å‘æ¶ˆæ¯ã€‚</p><img src="/2024/04/24/tcp%20socket%E5%9B%9E%E5%BF%86%E5%BD%95/image-20240424122417891.png" class="" title="image-20240424122417891"><p>åˆ«äººå®è·µè¯¾ï¼šåˆ›å»ºå¥—æ¥å­—ï¼Œç»‘å®šipç«¯å£ï¼Œç¼–è¾‘hello worldï¼Œsendâ€¦.</p><p>æˆ‘ï¼šå¤šçº¿ç¨‹ï¼ˆæœ¬è´¨è¿˜æ˜¯å¤šè¿›ç¨‹ï¼‰éå†å±€åŸŸç½‘ç½‘æ®µï¼Œç‹ ç‹ åœ°while Trueå‘é€ä¹±ç æ¶ˆæ¯ï¼Œç„¶åçœ‹ç€åˆ«äººçš„å·¥å…·å¡æ­»ã€‚</p><p>ç›®å‰åšäº†ä¸ªdemoï¼Œdms client&gt;tcp&gt;es&gt;mysql&gt;http&gt;é’‰é’‰â€¦</p><p>æ™šç‚¹å†å†™ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> ç½‘ç»œé€šä¿¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pycharm2022å¡æ­»</title>
      <link href="/2024/04/23/pycharm%E5%8D%A1%E6%AD%BB/"/>
      <url>/2024/04/23/pycharm%E5%8D%A1%E6%AD%BB/</url>
      
        <content type="html"><![CDATA[<p>é€†å¤©</p><img src="/2024/04/23/pycharm%E5%8D%A1%E6%AD%BB/image-20240423231412682.png" class="" title="image-20240423231412682">]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gpså’Œgprsçš„åŒºåˆ«</title>
      <link href="/2024/04/19/gps%E5%92%8Cgprs%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2024/04/19/gps%E5%92%8Cgprs%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€-GPSï¼ˆå…¨çƒå®šä½ç³»ç»Ÿ-global-position-systemï¼‰"><a href="#ä¸€-GPSï¼ˆå…¨çƒå®šä½ç³»ç»Ÿ-global-position-systemï¼‰" class="headerlink" title="ä¸€. GPSï¼ˆå…¨çƒå®šä½ç³»ç»Ÿ global position systemï¼‰"></a>ä¸€. GPSï¼ˆå…¨çƒå®šä½ç³»ç»Ÿ global position systemï¼‰</h2><p>æ˜¯ä¸€ç§å®šä½æŠ€æœ¯ï¼Œç”¨æ¥ç¡®è®¤ç‰©ä½“çš„ç»çº¬åº¦ä½ç½®</p><p>ç»´åŸºç™¾ç§‘ï¼š<a href="https://zh.wikipedia.org/zh-hans/GPS">https://zh.wikipedia.org/zh-hans/GPS</a></p><h2 id="äºŒ-GPRSï¼ˆé€šç”¨åˆ†ç»„æ— çº¿æ•°æ®æœåŠ¡-general-packet-radio-serviceï¼‰"><a href="#äºŒ-GPRSï¼ˆé€šç”¨åˆ†ç»„æ— çº¿æ•°æ®æœåŠ¡-general-packet-radio-serviceï¼‰" class="headerlink" title="äºŒ. GPRSï¼ˆé€šç”¨åˆ†ç»„æ— çº¿æ•°æ®æœåŠ¡ general packet radio serviceï¼‰"></a>äºŒ. GPRSï¼ˆé€šç”¨åˆ†ç»„æ— çº¿æ•°æ®æœåŠ¡ general packet radio serviceï¼‰</h2><p>åªæ˜¯ä¸€ç§æ•°æ®ä¼ è¾“æ–¹å¼ï¼Œç”¨æ¥ä¼ é€’æ•°æ®ç»„ç¾¤ï¼Œå¦‚åŒå‘é€æ‰‹æœºçŸ­ä¿¡ï¼Œä¸å…·å¤‡å®šä½åŠŸèƒ½ </p><p>ç»´åŸºç™¾ç§‘ï¼š<a href="https://zh.wikipedia.org/zh-hans/GPRS">https://zh.wikipedia.org/zh-hans/GPRS</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ç§‘æ™® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>htmlåµŒå…¥å¾®åšå…³æ³¨æŒ‰é’®</title>
      <link href="/2024/04/19/html%E5%B5%8C%E5%85%A5%E5%BE%AE%E5%8D%9A%E5%85%B3%E6%B3%A8%E6%8C%89%E9%92%AE/"/>
      <url>/2024/04/19/html%E5%B5%8C%E5%85%A5%E5%BE%AE%E5%8D%9A%E5%85%B3%E6%B3%A8%E6%8C%89%E9%92%AE/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:wb</span>=<span class="string">&quot;http://open.weibo.com/wb&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://tjs.sjs.sinajs.cn/open/api/js/wb.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;weibo&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">wb:follow-button</span> <span class="attr">uid</span>=<span class="string">&quot;å¾®åšuid&quot;</span> <span class="attr">width</span>=<span class="string">&quot;136&quot;</span> <span class="attr">height</span>=<span class="string">&quot;24&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">wb:follow-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¾®åšçš„uidï¼šåœ¨ä»»ä½•äººçš„å¾®åšä¸»é¡µï¼Œå¤åˆ¶åˆ†äº«é“¾æ¥ï¼Œåç¼€å°±æ˜¯uid</p><p>æ¯”å¦‚æ—¥å¨ƒçš„å¾®åšï¼š<a href="https://weibo.com/u/1865990891">https://weibo.com/u/1865990891</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitå¸¸ç”¨å‘½ä»¤</title>
      <link href="/2024/04/19/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2024/04/19/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h3 id="æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯"><a href="#æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯"></a>æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ä»£ç æ‰€åœ¨åˆ†æ”¯"><a href="#æŸ¥çœ‹ä»£ç æ‰€åœ¨åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹ä»£ç æ‰€åœ¨åˆ†æ”¯"></a>æŸ¥çœ‹ä»£ç æ‰€åœ¨åˆ†æ”¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -v</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯åˆ—è¡¨"><a href="#æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯åˆ—è¡¨"></a>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -r</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯åˆ—è¡¨"><a href="#æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯åˆ—è¡¨"></a>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯åˆ—è¡¨"><a href="#æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯åˆ—è¡¨"></a>æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯åˆ—è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºåˆ†æ”¯"><a href="#åˆ›å»ºåˆ†æ”¯" class="headerlink" title="åˆ›å»ºåˆ†æ”¯"></a>åˆ›å»ºåˆ†æ”¯</h3><ol><li>åˆ›å»ºæ–°branch</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b dev</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ‡æ¢å›ä¸»åˆ†æ”¯</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br></pre></td></tr></table></figure><ol start="3"><li>åˆå¹¶æ–°åˆ†æ”¯åˆ°ä¸»åˆ†æ”¯</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge dev</span><br></pre></td></tr></table></figure><ol start="4"><li>push</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin dev</span><br></pre></td></tr></table></figure><h3 id="åˆ‡æ¢åˆ†æ”¯æˆ–æŒ‡å®šç‰ˆæœ¬"><a href="#åˆ‡æ¢åˆ†æ”¯æˆ–æŒ‡å®šç‰ˆæœ¬" class="headerlink" title="åˆ‡æ¢åˆ†æ”¯æˆ–æŒ‡å®šç‰ˆæœ¬"></a>åˆ‡æ¢åˆ†æ”¯æˆ–æŒ‡å®šç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout [branch name]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout [version <span class="built_in">hash</span>]</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ä¸Šä¸€æ¬¡æäº¤è¯¦æƒ…"><a href="#ä¿®æ”¹ä¸Šä¸€æ¬¡æäº¤è¯¦æƒ…" class="headerlink" title="ä¿®æ”¹ä¸Šä¸€æ¬¡æäº¤è¯¦æƒ…"></a>ä¿®æ”¹ä¸Šä¸€æ¬¡æäº¤è¯¦æƒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure><p>ä¼šè¿›å…¥ä¸€ä¸ªvimç¼–è¾‘é¡µé¢ï¼Œç„¶åé‡æ–°æäº¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --force</span><br></pre></td></tr></table></figure><h3 id="å°†æ—¥å¿—å†™å…¥æ–‡ä»¶"><a href="#å°†æ—¥å¿—å†™å…¥æ–‡ä»¶" class="headerlink" title="å°†æ—¥å¿—å†™å…¥æ–‡ä»¶"></a>å°†æ—¥å¿—å†™å…¥æ–‡ä»¶</h3><p>é»˜è®¤å†™å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> &gt; ./git.log</span><br></pre></td></tr></table></figure><p>æ ¼å¼åŒ–å†™å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --format=<span class="string">&quot;hashï¼š%H%næäº¤äººï¼š%an &lt;%ae&gt;%næ—¥æœŸï¼š%ad%næ›´æ–°å†…å®¹ï¼š%s%n&quot;</span> &gt; git.log</span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶åˆ†æ”¯"><a href="#åˆå¹¶åˆ†æ”¯" class="headerlink" title="åˆå¹¶åˆ†æ”¯"></a>åˆå¹¶åˆ†æ”¯</h2><p>ä¾‹å¦‚ï¼Œdevåˆå¹¶åˆ°master</p><ol><li><strong>åˆ‡æ¢åˆ°</strong><code>master</code>åˆ†æ”¯ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout master </span><br></pre></td></tr></table></figure><ol start="2"><li><strong>æ›´æ–°</strong><code>master</code>åˆ†æ”¯ï¼š</li></ol><p>åœ¨åˆå¹¶å‰ï¼Œç¡®ä¿<code>master</code>åˆ†æ”¯æ˜¯æœ€æ–°çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull </span><br></pre></td></tr></table></figure><ol start="3"><li><strong>åˆå¹¶</strong><code>dev</code>åˆ†æ”¯åˆ°<code>master</code>ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge dev </span><br></pre></td></tr></table></figure><ol start="4"><li><strong>å¯èƒ½å‡ºç°çš„å†²çª</strong></li></ol><p>å¦‚æœåœ¨åˆå¹¶è¿‡ç¨‹å‡ºç°å†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³ï¼Œç„¶åå†æ·»åŠ æ–°çš„æ›´æ”¹åˆ°git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add . </span><br></pre></td></tr></table></figure><ol start="5"><li><strong>æäº¤æ¨é€</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;Merge dev into master&quot;</span> </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockeréƒ¨ç½²redisï¼ˆcentos7.9ï¼‰</title>
      <link href="/2024/04/17/docker%E9%83%A8%E7%BD%B2redis%EF%BC%88centos7.9%EF%BC%89/"/>
      <url>/2024/04/17/docker%E9%83%A8%E7%BD%B2redis%EF%BC%88centos7.9%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="1-åˆ›å»ºæ•°æ®ç›®å½•å’Œé…ç½®æ–‡ä»¶ç›®å½•"><a href="#1-åˆ›å»ºæ•°æ®ç›®å½•å’Œé…ç½®æ–‡ä»¶ç›®å½•" class="headerlink" title="1. åˆ›å»ºæ•°æ®ç›®å½•å’Œé…ç½®æ–‡ä»¶ç›®å½•"></a>1. åˆ›å»ºæ•°æ®ç›®å½•å’Œé…ç½®æ–‡ä»¶ç›®å½•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p  /data/redis/data</span><br></pre></td></tr></table></figure><p><code>/data/redis</code>é…ç½®æ–‡ä»¶æ”¾å®¿ä¸»æœºçš„é…ç½®æ–‡ä»¶</p><p><code>/data/redis/data</code>æŒä¹…åŒ–æ–‡ä»¶å’Œå®¹å™¨çš„é…ç½®æ–‡ä»¶</p><p>å¯åŠ¨å®¹å™¨åï¼Œ<code>/data/redis/data</code>ä¸‹è¿˜ä¼šæœ‰ä¸€å±‚&#x2F;redisï¼Œé‡Œé¢å°±æ˜¯å®¹å™¨çš„é…ç½®æ–‡ä»¶</p><h2 id="2-åˆ›å»ºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶"><a href="#2-åˆ›å»ºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶" class="headerlink" title="2. åˆ›å»ºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶"></a>2. åˆ›å»ºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶</h2><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://gitee.com/wangyue123com_admin/helpdocument/blob/master/package/redis.conf">https://gitee.com/wangyue123com_admin&#x2F;helpdocument&#x2F;blob&#x2F;master&#x2F;package&#x2F;redis.conf</a></p><p>å¹¶ä¿®æ”¹è‹¥å¹²é…ç½®ï¼Œå¦‚ï¼šå¯†ç requirepass, ç»‘å®šåœ°å€bindï¼Œç«¯å£å·port, åå°è¿è¡Œdaemonize</p><p><code>daemonize</code>å®ˆæŠ¤è¿›ç¨‹é»˜è®¤ä¸º<code>no</code>ï¼Œåœ¨dockerä¸­ä¸‹æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºï¼š</p><p>å®¹å™¨ä¸è¿›ç¨‹ï¼š<br>å®¹å™¨æ˜¯å›´ç»•å•ä¸ªè¿›ç¨‹è®¾è®¡çš„ã€‚å½“è¯¥è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå®¹å™¨ä¹Ÿä¼šåœæ­¢ã€‚å› æ­¤ï¼Œåœ¨Dockerå®¹å™¨ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºé€šå¸¸åº”è¯¥åœ¨å‰å°è¿è¡Œï¼Œä»¥ä¾¿Dockerå¯ä»¥æ­£ç¡®ç®¡ç†å’Œç›‘æ§è¯¥è¿›ç¨‹ã€‚</p><p>æ—¥å¿—ç®¡ç†ï¼š<br>å½“Redisåœ¨å‰å°è¿è¡Œæ—¶ï¼Œå®ƒçš„è¾“å‡ºï¼ˆæ—¥å¿—ï¼‰ä¼šç›´æ¥å‘é€åˆ°æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰å’Œæ ‡å‡†é”™è¯¯ï¼ˆstderrï¼‰ï¼Œè¿™ä½¿å¾—Dockerå¯ä»¥æ•è·å¹¶ç®¡ç†è¿™äº›æ—¥å¿—ã€‚å¦‚æœRedisä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œè¿™äº›æ—¥å¿—å¯èƒ½ä¸ä¼šè¢«Dockeræ•è·ã€‚</p><p>ç®€åŒ–é…ç½®ï¼š åœ¨Dockerç¯å¢ƒä¸­ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®ï¼ˆdaemonize noï¼‰å¯ä»¥ç®€åŒ–é…ç½®å’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œå› ä¸ºæ‚¨ä¸éœ€è¦å¯¹Redisè¿›è¡Œç‰¹æ®Šé…ç½®æ¥ç¡®ä¿å®ƒä»¥å®ˆæŠ¤è¿›ç¨‹å½¢å¼è¿è¡Œã€‚</p><p>xzdç”Ÿäº§ç¯å¢ƒçš„redisè®¾ç½®daemonizeyes â†’ noæ˜¯å› ä¸ºï¼š</p><p>å½“æ—¶çš„redisæ˜¯æºç å®‰è£…çš„ï¼Œä½¿ç”¨systemctlç®¡ç†æ€»æ˜¯æ— æ³•æ­£ç¡®åŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ²¡æ³•é…ç½®å¼€æœºè‡ªå¯åŠ¨ï¼Œåªèƒ½æ›²çº¿æ•‘å›½ï¼Œå†™äº†ä¸€ä¸ªshellè„šæœ¬å»å¯åŠ¨rediså®ä¾‹ï¼Œç„¶åä½¿ç”¨systemctlç®¡ç†è¿™ä¸ªè„šæœ¬ï¼Œå¹¶ä¸”è®¾ç½®è‡ªå¯åŠ¨ã€‚ä½†daemonizeæ˜¯yesï¼Œè„šæœ¬è¿è¡Œä¸€æ¬¡rediså°±æŒ‚åˆ°åå°äº†ï¼Œsystemctlè®¤ä¸ºè„šæœ¬å·²ç»æ‰§è¡Œç»“æŸï¼Œæ‰€ä»¥æŸ¥è¯¢è„šæœ¬çŠ¶æ€å°±æ˜¯exitã€‚äºæ˜¯è®¾ç½®redisä¸ºå‰å°è¿è¡Œã€‚</p><h2 id="3-åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨"><a href="#3-åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨" class="headerlink" title="3. åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨"></a>3. åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd  --name  redis-new --privileged=<span class="literal">true</span> -v /data/redis/redis.conf:/data/redis/redis.conf -v /data/redis/data:/data  -p 46379:6379  redis redis-server /data/redis/redis.conf</span><br></pre></td></tr></table></figure><p>å¯¹è¯¥å‘½ä»¤å„ä¸ªéƒ¨åˆ†çš„è¯¦ç»†è§£é‡Šï¼š</p><ol><li><code>docker run</code>ï¼šè¿™æ˜¯Dockerçš„åŸºæœ¬å‘½ä»¤ï¼Œç”¨æ¥è¿è¡Œä¸€ä¸ªæ–°çš„å®¹å™¨ã€‚</li><li><code>-itd</code>ï¼šè¿™ä¸ªå‚æ•°å®é™…ä¸Šæ˜¯ä¸‰ä¸ªå‚æ•°çš„ç»„åˆã€‚<code>-i</code>ï¼ˆæˆ–<code>--interactive</code>ï¼‰ä¿æŒå®¹å™¨çš„æ ‡å‡†è¾“å…¥å¼€æ”¾ï¼Œå³ä½¿ä¸é™„åŠ åˆ°å®¹å™¨ã€‚<code>-t</code>ï¼ˆæˆ–<code>--tty</code><br>ï¼‰ä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚<code>-d</code>ï¼ˆæˆ–<code>--detach</code>ï¼‰è¡¨ç¤ºåœ¨åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶æ‰“å°å®¹å™¨IDã€‚</li><li><code>--name redis-new</code>ï¼šè¿™ä¸ªå‚æ•°ä¸ºæ‚¨çš„å®¹å™¨æŒ‡å®šä¸€ä¸ªåå­—ï¼Œè¿™é‡Œåå­—æ˜¯<code>redis-new</code>ã€‚</li><li><code>--privileged=true</code>ï¼šè¿™ä¸ªå‚æ•°ç»™å®¹å™¨æä¾›é¢å¤–çš„æƒé™ã€‚å½“è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œå®¹å™¨å‡ ä¹å…·æœ‰ç›¸åŒçš„æƒé™ä½œä¸ºå®¿ä¸»æœºä¸Šçš„è¿›ç¨‹ã€‚</li><li><code>-v /data/redis/redis.conf:/data/redis/redis.conf</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå·æŒ‚è½½å‘½ä»¤ã€‚å®ƒå°†å®¿ä¸»æœºä¸Šçš„<code>/data/redis/redis.conf</code><br>æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨å†…çš„<code>/data/redis/redis.conf</code>ã€‚è¿™å…è®¸ä½ ä½¿ç”¨è‡ªå®šä¹‰çš„Redisé…ç½®ã€‚</li><li><code>-v /data/redis/data:/data</code>ï¼šåŒæ ·æ˜¯ä¸€ä¸ªå·æŒ‚è½½å‘½ä»¤ï¼Œå°†å®¿ä¸»æœºçš„<code>/data/redis/data</code>ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„<code>/data</code><br>ç›®å½•ã€‚è¿™é€šå¸¸ç”¨äºæŒä¹…åŒ–Redisæ•°æ®ã€‚</li><li><code>-p 46379:6379</code>ï¼šè¿™æ˜¯ç«¯å£æ˜ å°„ã€‚å®ƒå°†å®¹å™¨å†…éƒ¨çš„6379ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„46379ç«¯å£ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½ åœ¨å®¿ä¸»æœºä¸Šè®¿é—®46379ç«¯å£æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¿é—®å®¹å™¨å†…éƒ¨çš„6379ç«¯å£ã€‚</li><li><code>redis</code>ï¼šè¿™æ˜¯è¦è¿è¡Œçš„Dockeré•œåƒçš„åç§°ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­æ˜¯å®˜æ–¹çš„Redisé•œåƒã€‚</li><li><code>redis-server /data/redis/redis.conf</code><br>ï¼šè¿™æ˜¯å®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ã€‚å®ƒå¯åŠ¨RedisæœåŠ¡å™¨å¹¶ä½¿ç”¨æ‚¨æä¾›çš„é…ç½®æ–‡ä»¶<code>/data/redis/redis.conf</code>ã€‚</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellæ‰¹é‡æ·»åŠ cronä»»åŠ¡</title>
      <link href="/2024/04/17/shell%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0cron%E4%BB%BB%E5%8A%A1/"/>
      <url>/2024/04/17/shell%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0cron%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¥æƒ³å†™ä¸ªè„šæœ¬æ‰¹é‡åˆ›å»ºä»»åŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">crontab -r</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 1 * * * /usr/bin/python3 /path/to/script1.py&quot;</span> | crontab -</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 2 * * * /usr/bin/python3 /path/to/script2.py&quot;</span> | crontab -</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 3 * * * /usr/bin/python3 /path/to/script3.py&quot;</span> | crontab -</span><br></pre></td></tr></table></figure><p>çœ‹ç€è·ŸçœŸçš„ä¼¼çš„ï¼Œä½†å…¶å®è¿™ä¸ªè€é€¼|ç®¡é“ç¬¦å·å†™çš„ä¸å¯¹ï¼Œè¿è¡Œååªæœ‰æœ€åä¸€ä¸ªä»»åŠ¡æ·»åŠ è¿›å»ã€‚<br>ä¿®æ”¹åï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">crontab -r</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 1 * * * /usr/bin/python3 /path/to/your/script1.py&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 2 * * * /usr/bin/python3 /path/to/your/script2.py&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 3 * * * /usr/bin/python3 /path/to/your/script3.py&quot;</span></span><br><span class="line">&#125; | crontab -</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨crontabè¿è¡Œpythonè„šæœ¬ï¼Œlogruæ—¥å¿—ä¸æ‰“å°ï¼šæ—¥å¿—è·¯å¾„ä¿®æ”¹ä¸ºç»å¯¹è·¯å¾„å³å¯ã€‚</p><p>crontabé»˜è®¤çš„æ—¥å¿—ï¼š&#x2F;var&#x2F;log&#x2F;cronï¼ˆåªèƒ½çœ‹åˆ°æ˜¯å¦æ‰§è¡Œï¼‰</p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç•…æ·é€šT+Cloudå®šåˆ¶å¼€å‘æŒ‡å—</title>
      <link href="/2024/04/17/%E7%95%85%E6%8D%B7%E9%80%9AT+Cloud%E5%AE%9A%E5%88%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"/>
      <url>/2024/04/17/%E7%95%85%E6%8D%B7%E9%80%9AT+Cloud%E5%AE%9A%E5%88%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h2 id=""><a href="#" class="headerlink" title=""></a></h2><blockquote><p>æŒ‰é¡ºåºå¾€ä¸‹èµ°å³å¯</p></blockquote><h2 id="1ã€ç”³è¯·å¼€å‘æµ‹è¯•è´¦å¥—"><a href="#1ã€ç”³è¯·å¼€å‘æµ‹è¯•è´¦å¥—" class="headerlink" title="1ã€ç”³è¯·å¼€å‘æµ‹è¯•è´¦å¥—"></a><strong>1ã€ç”³è¯·å¼€å‘æµ‹è¯•è´¦å¥—</strong></h2><p>æ“¦äº®çœ¼ç›ï¼Œåˆ«é€‰é”™è´¦å¥—</p><h2 id="2ã€åˆ›å»ºåº”ç”¨"><a href="#2ã€åˆ›å»ºåº”ç”¨" class="headerlink" title="2ã€åˆ›å»ºåº”ç”¨"></a><strong>2ã€åˆ›å»ºåº”ç”¨</strong></h2><p>æ§åˆ¶å° â†’ åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨ â†’ å¯¹æ¥ä¸»åº”ç”¨é€‰æ‹© <code>TPlus</code></p><h2 id="3ã€ç”Ÿæˆæˆæƒè¯ä¹¦"><a href="#3ã€ç”Ÿæˆæˆæƒè¯ä¹¦" class="headerlink" title="3ã€ç”Ÿæˆæˆæƒè¯ä¹¦"></a><strong>3ã€ç”Ÿæˆæˆæƒè¯ä¹¦</strong></h2><p>tokenæ˜¯äºŒå¼€é‰´æƒçš„æœ€åä¸€é“é˜²çº¿ï¼Œè¯ä¹¦ç”¨äºè·å–tokenï¼Œä¸ºäº†è¯æ˜ä½ æ˜¯ä¸€ä¸ªè¢«æˆæƒçš„å¼€å‘è€…ã€‚</p><p>æ§åˆ¶å° â†’ é€‰æ‹©åº”ç”¨ â†’ å¼€å‘ç®¡ç† â†’ æƒé™ç®¡ç† â†’ æ‰¾ä¸€ä¸ªç®¡ç†å‘˜ â†’ ç”Ÿæˆæˆæƒé“¾æ¥ â†’ ä¿å­˜æˆæƒè¯ä¹¦ï¼ˆé•¿æœŸæœ‰æ•ˆï¼‰</p><h2 id="4ã€é…ç½®å¯ä¿¡åŸŸå"><a href="#4ã€é…ç½®å¯ä¿¡åŸŸå" class="headerlink" title="4ã€é…ç½®å¯ä¿¡åŸŸå"></a><strong>4ã€é…ç½®å¯ä¿¡åŸŸå</strong></h2><p><strong>å°±æ˜¯æ€•ä½ ä¹±ç”³è¯·tokenæäº‹æƒ…ï¼Œé…ç½®äº†å¯ä¿¡åŸŸååï¼Œå°±èƒ½ä»tokenè¿½æº¯åˆ°å…·ä½“çš„ISVå’Œä¸ºå…¶é¢å‘æˆæƒè¯ä¹¦çš„åº”ç”¨ç®¡ç†å‘˜ã€‚</strong></p><p>æ§åˆ¶å° â†’ å·¦ä¾§å¯ä¿¡åŸŸåç®¡ç† â†’ ä¸‹è½½<code>CHANJET_CHECK.txt</code>æ–‡ä»¶ â†’ æ”¾åˆ°å›è°ƒæœåŠ¡å™¨çš„<strong>80æˆ–443ç«¯å£</strong>çš„æ ¹è·¯ç”±ä¸‹â†’ å›åˆ°æ¶ˆæ¯é…ç½®é¡µé¢ â†’<br>è¾“å…¥AESå¯†é’¥ â†’ è¾“å…¥æ¶ˆæ¯æ¥æ”¶åœ°å€ã€‚</p><p><strong>âš ï¸ ä¸€ä¸ªåŸŸååªèƒ½ç»‘å®šä¸€ä¸ªè´¦å¥—ï¼ˆå¹³å°ä¼šæŸ¥é‡ï¼‰</strong></p><p><strong>âš ï¸ ç»è¿‡ä¸ºæœŸä¸€ä¸ªæœˆçš„æµ‹è¯•ï¼Œç»‘å®šå¯ä¿¡åŸŸååï¼ŒæŠŠ</strong><code>CHANJET_CHECK.txt</code>ä¿®æ”¹ä¸ºå…¶ä»–ä¼ä¸š<br>ï¼Œç”šè‡³åˆ é™¤æ‰ï¼Œä»ä¸å½±å“å›è°ƒä½¿ç”¨ï¼Œå¹³å°è¯´ä¸å®šæœŸæ‹¨æµ‹å¯èƒ½æ˜¯åœ¨å¿½æ‚ ä½ ã€‚</p><h2 id="5ã€é…ç½®å›è°ƒæœåŠ¡å™¨åœ°å€"><a href="#5ã€é…ç½®å›è°ƒæœåŠ¡å™¨åœ°å€" class="headerlink" title="5ã€é…ç½®å›è°ƒæœåŠ¡å™¨åœ°å€"></a><strong>5ã€é…ç½®å›è°ƒæœåŠ¡å™¨åœ°å€</strong></h2><p>æ§åˆ¶å° â†’ é€‰æ‹©ä¼ä¸šè‡ªå»ºåº”ç”¨ â†’ åº”ç”¨åŠŸèƒ½ â†’ æ¶ˆæ¯è®¢é˜… â†’ æ¶ˆæ¯é…ç½®</p><p>æ‰€æœ‰çš„å›è°ƒæ¶ˆæ¯ï¼Œéƒ½æ˜¯AESåŠ å¯†çš„ï¼Œæ‰€ä»¥å…ˆ<strong>é…ç½®æ¶ˆæ¯ç§˜é’¥</strong>ï¼ˆ<strong>é•¿åº¦å¿…é¡»æ˜¯16ä½</strong>ï¼‰</p><p>ç„¶åé…ç½®æ¶ˆæ¯æ¥æ”¶åœ°å€ï¼ˆåç»­æ‰€æœ‰çš„å›è°ƒï¼ŒåŒ…æ‹¬æ¶ˆæ¯è®¢é˜…ï¼Œéƒ½ä¼šèµ°è¿™ä¸€ä¸ªæ¥å£ï¼‰</p><p><strong>ä¸ç®¡ç»™ä½ å‘å•¥ï¼Œå¿…é¡»åœ¨ä¸€ç§’å†…å“åº”</strong><code>&#123;&quot;result&quot;: &quot;success&quot;&#125;</code><strong>ï¼Œé•¿æ—¶é—´å“åº”å¼‚å¸¸ï¼Œä¼šè¢«ä¸­æ–­æ¶ˆæ¯æ¨é€ã€‚</strong></p><p>è¢«ä¸­æ–­åï¼Œå¯ä»¥åˆ°æ¶ˆæ¯è®¢é˜…ä¸­ï¼Œç‚¹å‡»<strong>é‡ç½®å¹¶å‘é€</strong>æŒ‰é’®ï¼Œæ¢å¤ä½¿ç”¨ã€‚æˆ–è€…è°ƒç”¨â€<strong>ç«‹å³è§¦å‘ ticket æ¨é€</strong>â€œæ¥å£ã€‚</p><h2 id="6ã€é…ç½®æœåŠ¡å™¨å…¬ç½‘åœ°å€-ï¼ˆå…¬æœ‰äº‘ä¸ç”¨çœ‹è¿™æ¡ï¼‰"><a href="#6ã€é…ç½®æœåŠ¡å™¨å…¬ç½‘åœ°å€-ï¼ˆå…¬æœ‰äº‘ä¸ç”¨çœ‹è¿™æ¡ï¼‰" class="headerlink" title="6ã€é…ç½®æœåŠ¡å™¨å…¬ç½‘åœ°å€ ï¼ˆå…¬æœ‰äº‘ä¸ç”¨çœ‹è¿™æ¡ï¼‰"></a><strong>6ã€é…ç½®æœåŠ¡å™¨å…¬ç½‘åœ°å€ ï¼ˆå…¬æœ‰äº‘ä¸ç”¨çœ‹è¿™æ¡ï¼‰</strong></h2><p><strong>ä¸“å±äº‘çš„é€šä¿¡æµç¨‹ï¼šä½ çš„ç¬¬ä¸‰æ–¹ç¨‹åº â†’ ç•…æ·é€šå¼€æ”¾å¹³å° â†’ ä¸“å±äº‘å®¢æˆ·ç«¯</strong></p><p><strong>è¿™ä¸ªå…¬ç½‘åœ°å€æŒ‡çš„æ˜¯å®¢æˆ· T+ ç³»ç»Ÿçš„å…¬ç½‘åœ°å€ï¼Œç®€å•è¯´å°±æ˜¯æŠŠå®ƒå‘Šè¯‰å¼€æ”¾å¹³å°ï¼Œå¹³å°æ‰èƒ½é€šè¿‡å…¬ç½‘å’Œä¸“å±äº‘é€šä¿¡ã€‚</strong></p><p>ç™»å½•T+ç®¡ç†å‘˜è´¦å· â†’ æœåŠ¡å™¨é…ç½® â†’ åœ°å€é…ç½® â†’ æµ‹è¯•è¿æ¥ï¼Œç„¶åç™»å½•å®¢æˆ·ç«¯åˆ°äº‘åº”ç”¨é‡Œæµ‹è¯•ä¸€ä¸‹æœåŠ¡å™¨ç½‘ç»œè¿æ¥ã€‚</p><h2 id="7ã€å¼€é€šä¸šåŠ¡æ¥å£æƒé™"><a href="#7ã€å¼€é€šä¸šåŠ¡æ¥å£æƒé™" class="headerlink" title="7ã€å¼€é€šä¸šåŠ¡æ¥å£æƒé™"></a><strong>7ã€å¼€é€šä¸šåŠ¡æ¥å£æƒé™</strong></h2><p>åƒä¸‡ä¸è¦è´¹ä¹ç‰›äºŒè™ä¹‹åŠ›è·å–åˆ° tokenæœ€åå‘ç°æ¥å£æŠ¥é”™<code>openTokenæ— è°ƒç”¨è¯¥æ¥å£çš„æƒé™</code>ï¼Œå†è¿”å›æ¥å¼€é€šã€‚</p><p>å’±ç›´æ¥å°‘èµ°åå¹´å¼¯è·¯ï¼Œæ§åˆ¶å° â†’ è‡ªå»ºåº”ç”¨ â†’ æƒé™ç®¡ç† â†’ å¼€é€šå¯¹åº”çš„æ¥å£æƒé™</p><h2 id="8ã€è·å–-app-ticket"><a href="#8ã€è·å–-app-ticket" class="headerlink" title="8ã€è·å– app_ticket"></a><strong>8ã€è·å– app_ticket</strong></h2><p>é…ç½®å¥½å¯ä¿¡åŸŸåå’Œæ¶ˆæ¯æ¥æ”¶åœ°å€åï¼Œå¹³å°æ¯10åˆ†é’Ÿç»™ä½ æ¨é€ä¸€æ¬¡ticketå¯†æ–‡ï¼Œç”¨ä¸Šè¿°é…å¥½çš„å¯†é’¥è§£å¯†ï¼Œè·å–ticketã€‚æ¯ä¸ªticketæœ‰æ•ˆæœŸ30åˆ†é’Ÿã€‚</p><p><strong>æ‰€æœ‰çš„å›è°ƒæˆ–è®¢é˜…æ¶ˆæ¯ï¼Œéƒ½ç”¨æ˜æ–‡è½½è·ä¸­çš„</strong><code>msgType</code><strong>åŒºåˆ†äº‹ä»¶ç±»å‹ã€‚</strong></p><h2 id="9ã€è·å–-open-token"><a href="#9ã€è·å–-open-token" class="headerlink" title="9ã€è·å– open_token"></a><strong>9ã€è·å– open_token</strong></h2><p>å®˜æ–¹æ¥å£æ–‡æ¡£ï¼š <a href="https://open.chanjet.com/docs/file/apiFile/common/selfBuiltApp/selfBuiltAppAuth?id=32086">T+è‡ªå»ºåº”ç”¨è·å–tokenæ¥å£</a></p><p>å°±æ˜¯ç”¨è‡ªå»ºåº”ç”¨ä¿¡æ¯å’Œåˆšæ‰ç”Ÿæˆçš„æˆæƒè¯ä¹¦+ticketå»è¯·æ±‚tokenæ¥å£ï¼Œè·å–tokenã€‚</p><p>ä»–çš„æœ‰æ•ˆæœŸæ¯”è¾ƒç‰›é€¼ï¼š<strong>6å¤©</strong>ï¼Œå¯ä»¥ç¼“å­˜ä¸‹æ¥ã€‚</p><p>å“åº”æ•°æ®ä¸­è¿˜æœ‰ä¸€ä¸ª refreshToken, æœ‰æ•ˆæœŸ 29 å¤©ï¼Œå¯ä»¥ç”¨ä»–ç›´æ¥åˆ·æ–° tokenã€‚</p><p>æ¥å£ï¼šGET  <a href="https://openapi.chanjet.com/auth/v2/refreshToken">https://openapi.chanjet.com/auth/v2/refreshToken</a></p><p>headersï¼šappkey å’Œ appSecret</p><p>paramsï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &#x27;grantType&#x27;: &#x27;refresh_token&#x27;,</span><br><span class="line">    &#x27;refreshToken&#x27;: &#x27;xxx&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10ã€æ¶ˆæ¯è®¢é˜…"><a href="#10ã€æ¶ˆæ¯è®¢é˜…" class="headerlink" title="10ã€æ¶ˆæ¯è®¢é˜…"></a><strong>10ã€æ¶ˆæ¯è®¢é˜…</strong></h2><p>æ§åˆ¶å° â†’ é€‰æ‹©è‡ªå»ºåº”ç”¨ â†’ åº”ç”¨åŠŸèƒ½ â†’ æ¶ˆæ¯è®¢é˜… â†’ æ¶ˆæ¯åˆ—è¡¨ â†’ è®¢é˜…æƒ³è¦çš„äº‹ä»¶ï¼ˆè¦è®°ä½è®¢é˜…æ¶ˆæ¯codeï¼‰ â†’ é‡æ–°ç”Ÿæˆæˆæƒè¯ä¹¦ï¼ˆå¦åˆ™è®¢é˜…ä¸ç”Ÿæ•ˆï¼‰</p><p>æœ‰ä¸ªbugï¼Œç›´æ¥ç‚¹å³ä¾§çš„æŸ¥çœ‹æ¶ˆæ¯ï¼Œæ— æ³•æŸ¥çœ‹æ¥å£æ–‡æ¡£ï¼Œéœ€è¦åˆ°å¼€æ”¾å¹³å° APIæ–‡æ¡£ â†’ T+API â†’ T+æ¶ˆæ¯è®¢é˜… æŸ¥çœ‹ ğŸ˜“</p><p>å¦‚æœå¼€å‘ç›®æ ‡æ˜¯æŠŠT+çš„æ•°æ®åŒæ­¥ç»™å…¶ä»–ç³»ç»Ÿï¼ˆå¦‚å®œæ­ï¼‰ï¼Œé‚£ä¹ˆåªéœ€è¦ç¬¬ä¸€æ¬¡éƒ¨ç½²ä¸Šçº¿æ—¶ï¼Œè°ƒT+ä¸šåŠ¡æ¥å£æ‰¹é‡åŒæ­¥è¿‡æ¥ï¼Œåç»­T+ä¸­å¢åŠ çš„æ•°æ®ï¼Œé‡‡ç”¨æ¶ˆæ¯è®¢é˜…å³å¯ï¼ŒT+å¢åŠ ä¸€æ¡ä½ å°±åŒæ­¥ä¸€æ¡ï¼Œé¿å…æ— æ„ä¹‰çš„å®šæ—¶ä»»åŠ¡æ¶ˆè€—èµ„æºã€‚</p><p>T+çš„æ¶ˆæ¯è®¢é˜…éå¸¸æœ´å®æ— åï¼šæ¯”å¦‚T+å¢åŠ äº†ä¸€ä¸ªå‡ºåº“å•ï¼Œä»–ä¼šé€šè¿‡http postä½ çš„æ¶ˆæ¯æ¥æ”¶åœ°å€ï¼Œå‘é€åŠ å¯†è½½è·ï¼Œè§£å¯†åæ ¹æ®msgTypeåˆ¤æ–­äº‹ä»¶ç±»å‹ï¼Œæ¯”å¦‚è®¢é˜…äº†ä»˜æ¬¾å•å®¡æ ¸ï¼ŒmsgTypeå°±æ˜¯ArapPayment_Auditã€‚è½½è·ä¸­å¸¦æœ‰å•æ®æ ‡è¯†voucherCodeï¼Œç„¶åä½ æ‹¿codeå»è¯·æ±‚æŸ¥è¯¢å•æ®çš„æ¥å£ï¼Œè·å–å•æ®çš„è¯¦æƒ…â€¦ â€¦</p><h3 id="æ”¶ä¸åˆ°ï¼Ÿä¸€èˆ¬ä¸“å±äº‘ä¼šè¿™æ ·"><a href="#æ”¶ä¸åˆ°ï¼Ÿä¸€èˆ¬ä¸“å±äº‘ä¼šè¿™æ ·" class="headerlink" title="æ”¶ä¸åˆ°ï¼Ÿä¸€èˆ¬ä¸“å±äº‘ä¼šè¿™æ ·"></a><strong>æ”¶ä¸åˆ°ï¼Ÿä¸€èˆ¬ä¸“å±äº‘ä¼šè¿™æ ·</strong></h3><p>å…ˆæ£€æŸ¥å®¢æˆ·<code>è´¦å¥—ç‰ˆæœ¬</code>æ˜¯å¦è¿‡ä½ï¼ˆå°äº16ï¼‰</p><p>å†æ£€æŸ¥T+çš„éƒ¨ç½²æœºå™¨ä¸Š<code>rabitmq</code>å¯åŠ¨äº†æ²¡</p><p>å†æ£€æŸ¥T+çš„éƒ¨ç½²æœºå™¨ä¸Šï¼ŒT+æœåŠ¡ç®¡ç†APPä¸­<code>å¼‚æ­¥ä»»åŠ¡</code>å¯åŠ¨äº†æ²¡</p><h2 id="11ã€ç»å…¸æŠ¥é”™æ±‡æ€»"><a href="#11ã€ç»å…¸æŠ¥é”™æ±‡æ€»" class="headerlink" title="11ã€ç»å…¸æŠ¥é”™æ±‡æ€»"></a><strong>11ã€ç»å…¸æŠ¥é”™æ±‡æ€»</strong></h2><h3 id="ä¸“å±äº‘è·å–tokenæŠ¥server-not-found"><a href="#ä¸“å±äº‘è·å–tokenæŠ¥server-not-found" class="headerlink" title="ä¸“å±äº‘è·å–tokenæŠ¥server not found"></a>ä¸“å±äº‘è·å–tokenæŠ¥<code>server not found</code></h3><p>æ²¡æœ‰é…ç½®æœåŠ¡å™¨å…¬ç½‘åœ°å€ã€‚çœ‹ç¬¬å…­æ¡ ã€‚</p><h3 id="ä¸šåŠ¡æ¥å£æŠ¥æœåŠ¡åç§°ä¸æ­£ç¡®"><a href="#ä¸šåŠ¡æ¥å£æŠ¥æœåŠ¡åç§°ä¸æ­£ç¡®" class="headerlink" title="ä¸šåŠ¡æ¥å£æŠ¥æœåŠ¡åç§°ä¸æ­£ç¡®"></a>ä¸šåŠ¡æ¥å£æŠ¥æœåŠ¡åç§°ä¸æ­£ç¡®</h3><p>ä¸€æŸ¥å®˜æ–¹æ–‡æ¡£ï¼Œè¯´ç³»ç»Ÿç‰ˆæœ¬ä½è¦æ‰“è¡¥ä¸ï¼Œ<strong>ä¸è¦è¢«ä»–è¯¯å¯¼</strong>ï¼Œä¸€å®šæ˜¯ä½ è¯·æ±‚å‚æ•°å†™é”™äº†ã€‚å‚æ•°ç¼ºå¤±ä»–ä¸æŠ¥å‚æ•°ç¼ºå¤±ï¼ŒæŠ¥æ‰“è¡¥ä¸çš„é”™â€¦ğŸ˜“</p><h3 id="æœªå°†å¯¹è±¡å¼•ç”¨è®¾ç½®åˆ°å¯¹è±¡çš„â€¦"><a href="#æœªå°†å¯¹è±¡å¼•ç”¨è®¾ç½®åˆ°å¯¹è±¡çš„â€¦" class="headerlink" title="æœªå°†å¯¹è±¡å¼•ç”¨è®¾ç½®åˆ°å¯¹è±¡çš„â€¦"></a>æœªå°†å¯¹è±¡å¼•ç”¨è®¾ç½®åˆ°å¯¹è±¡çš„â€¦</h3><p>è¯·æ±‚å‚æ•°ç¼ºå¤±äº†ï¼Œç±»å‹ä¼ é”™äº†ï¼Œéƒ½ä¼šè¿™æ ·ï¼Œåæ­£å°±æ˜¯å¯¹æ–¹æŠ¥é”™äº† ï¼Œè€æ¯›ç—…äº†ğŸ˜“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: &quot;EXERROR0001&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;æœªå°†å¯¹è±¡å¼•ç”¨è®¾ç½®åˆ°å¯¹è±¡çš„å®ä¾‹ï¼Œè°ƒç”¨å †æ ˆä¸º   åœ¨ Ufida.T.EAP.Aop.Server.ServerDynamicProxyImpl.NormalInvoke(MethodBase method, Object[] args)\r\n   åœ¨ Ufida.T.EAP.Aop.Server.ServerDynamicProxyImpl.Invoke(IMessage message)\r\n   åœ¨ System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData&amp; msgData, Int32 type)\r\n   åœ¨ Ufida.T.BAP.Base.VoucherAPI.IVoucherAPIService.Save(DTO dto, APIParamDTO apiParam)&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;Code&quot;: &quot;EXERROR0001&quot;,</span><br><span class="line">        &quot;StatusCode&quot;: 400</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12ã€å…³äºåŸºç¡€æ¡£æ¡ˆæŸ¥è¯¢"><a href="#12ã€å…³äºåŸºç¡€æ¡£æ¡ˆæŸ¥è¯¢" class="headerlink" title="12ã€å…³äºåŸºç¡€æ¡£æ¡ˆæŸ¥è¯¢"></a><strong>12ã€å…³äºåŸºç¡€æ¡£æ¡ˆæŸ¥è¯¢</strong></h2><p>é»˜è®¤åªè¿”å›åŸºç¡€å­—æ®µï¼Œå¦‚ nameã€codeï¼Œè¦ä½¿ç”¨ <code>SelectFields</code>æ¥è¿‡æ»¤å­—æ®µï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;param&quot;: &#123;</span><br><span class="line">        &quot;SelectFields&quot;: &quot;ID,Code,Name,Unit.Code,Unit.Name&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>âš ï¸ 1ã€ å­˜è´§æŸ¥è¯¢ï¼Œå¦‚ä¼ å…¥é”™è¯¯å­—æ®µï¼Œå°†å¯¼è‡´æŸ¥è¯¢ç»“æœå…¨ä¸ºç©ºã€‚</strong></p><p><strong>âš ï¸ 2ã€ ä»“åº“æŸ¥è¯¢ï¼Œ SelectFields ä¸­çš„å­—æ®µåä¸åŒºåˆ†å¤§å°å†™ï¼ŒæŸ¥ä»€ä¹ˆè¿”å›ä»€ä¹ˆï¼Œæ¯”å¦‚ï¼š</strong></p><p>æŸ¥è¯¢å‚æ•°ï¼šname å¯ä»¥å†™æˆ Nameï¼Œä¹Ÿå¯ä»¥å†™æˆ NaMeï¼Œæˆ–è€… NAMEã€namE</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;param&quot;: &#123;</span><br><span class="line">        &quot;Selectfields&quot;: &quot;ID,Code,NaMe&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›å‚æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;ID&quot;: 1,</span><br><span class="line">        &quot;Code&quot;: &quot;01&quot;,</span><br><span class="line">        &quot;NaMe&quot;: &quot;æˆå“ä»“&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ä½ ç”šè‡³å¯ä»¥ä¼ å…¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;param&quot;: &#123;</span><br><span class="line">        &quot;Selectfields&quot;: &quot;ID,Code,NaMe,å¤©ç‹ç›–åœ°è™,å®å¡”é•‡æ²³å¦–&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;param&quot;: &#123;</span><br><span class="line">        &quot;Selectfields&quot;: &quot;ID,Code,NaMe,å¤©ç‹ç›–åœ°è™,å®å¡”é•‡æ²³å¦–@@@@</span><br><span class="line">        dasdad666&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›å‚æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;ID&quot;: 1,</span><br><span class="line">        &quot;Code&quot;: &quot;01&quot;,</span><br><span class="line">        &quot;NaMe&quot;: &quot;æˆå“ä»“&quot;,</span><br><span class="line">        &quot;å¤©ç‹ç›–åœ°è™&quot;: null,</span><br><span class="line">        &quot;å®å¡”é•‡æ²³å¦–&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;ID&quot;: 1,</span><br><span class="line">        &quot;Code&quot;: &quot;01&quot;,</span><br><span class="line">        &quot;NaMe&quot;: &quot;æˆå“ä»“&quot;,</span><br><span class="line">        &quot;å¤©ç‹ç›–åœ°è™&quot;: null,</span><br><span class="line">        &quot;å®å¡”é•‡æ²³å¦–@@@@\n        dasdad666&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç³»ç»Ÿé›†æˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerå‡çº§åè¿è¡Œå®¹å™¨æŠ¥é”™ï¼ˆcentos7.9ï¼‰</title>
      <link href="/2023/10/18/docker%E5%8D%87%E7%BA%A7%E5%90%8E%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%E6%8A%A5%E9%94%99%EF%BC%88centos7.9%EF%BC%89/"/>
      <url>/2023/10/18/docker%E5%8D%87%E7%BA%A7%E5%90%8E%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%E6%8A%A5%E9%94%99%EF%BC%88centos7.9%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response from daemon: Unknown runtime specified docker-runc</span><br></pre></td></tr></table></figure><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>å¯èƒ½æ˜¯å› ä¸ºä»ä¸å…¼å®¹çš„ç‰ˆæœ¬å‡çº§äº†dockerï¼Œæ›´æ”¹&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containersç›®å½•ä¸­çš„æ–‡ä»¶å‚æ•°ï¼ŒæŠŠdocker-runcæ›¿æ¢ä¸ºrunc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -rl <span class="string">&#x27;docker-runc&#x27;</span> /var/lib/docker/containers/ | xargs sed -i <span class="string">&#x27;s/docker-runc/runc/g&#x27;</span></span><br></pre></td></tr></table></figure><p>grep -rlï¼šé€’å½’æœç´¢ç›®å½•å’Œå­ç›®å½•ï¼Œåªåˆ—å‡ºå«æœ‰åŒ¹é…çš„æ–‡æœ¬è¡Œçš„æ–‡ä»¶åï¼Œè€Œä¸æ˜¾ç¤ºå…·ä½“çš„åŒ¹é…å†…å®¹</p><p>xargsï¼šè¡”æ¥æ‰§è¡Œä¹‹å‰å¾—åˆ°çš„å€¼</p><p>æ€»ä½“æ„æ€æ˜¯æŠŠ&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containersä¸­å«æœ‰docker-runcçš„æ–‡ä»¶æœç´¢å‡ºæ¥ï¼Œæ›´æ”¹ä¸ºruncï¼Œç„¶åé‡å¯dockerã€é‡å¯å®¹å™¨å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart [å®¹å™¨<span class="built_in">id</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerç‰ˆæœ¬å‡çº§ï¼ˆcentos7.9ï¼‰</title>
      <link href="/2023/10/17/docker%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%EF%BC%88centos7.9%EF%BC%89/"/>
      <url>/2023/10/17/docker%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%EF%BC%88centos7.9%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="1-æŸ¥çœ‹å·²å®‰è£…çš„æ–‡ä»¶"><a href="#1-æŸ¥çœ‹å·²å®‰è£…çš„æ–‡ä»¶" class="headerlink" title="1. æŸ¥çœ‹å·²å®‰è£…çš„æ–‡ä»¶"></a>1. æŸ¥çœ‹å·²å®‰è£…çš„æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list installed |grep docker </span><br></pre></td></tr></table></figure><h2 id="2-åˆ é™¤å·²å®‰è£…çš„æ–‡ä»¶"><a href="#2-åˆ é™¤å·²å®‰è£…çš„æ–‡ä»¶" class="headerlink" title="2. åˆ é™¤å·²å®‰è£…çš„æ–‡ä»¶"></a>2. åˆ é™¤å·²å®‰è£…çš„æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove xxx</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œç¬¬ä¸€æ­¥æ£€æŸ¥æ˜¯å¦åˆ é™¤æˆåŠŸ</p><h2 id="3-å®‰è£…å­˜å‚¨åº“"><a href="#3-å®‰è£…å­˜å‚¨åº“" class="headerlink" title="3. å®‰è£…å­˜å‚¨åº“"></a>3. å®‰è£…å­˜å‚¨åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><h2 id="4-æ·»åŠ é•œåƒæº-aliyun"><a href="#4-æ·»åŠ é•œåƒæº-aliyun" class="headerlink" title="4. æ·»åŠ é•œåƒæº(aliyun)"></a>4. æ·»åŠ é•œåƒæº(aliyun)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><h2 id="5-1-ä¸‹è½½æœ€æ–°ç‰ˆ"><a href="#5-1-ä¸‹è½½æœ€æ–°ç‰ˆ" class="headerlink" title="5.1 ä¸‹è½½æœ€æ–°ç‰ˆ"></a>5.1 ä¸‹è½½æœ€æ–°ç‰ˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure><p><code>docker-ce</code>: è¿™æ˜¯ Docker ç¤¾åŒºç‰ˆçš„ä¸»è¦è½¯ä»¶åŒ…ï¼ŒåŒ…å« Docker çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p><p><code>docker-ce-cli</code>: è¿™æ˜¯ Docker ç¤¾åŒºç‰ˆçš„å‘½ä»¤è¡Œç•Œé¢å·¥å…·ï¼Œç”¨äºä¸ Docker å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œäº¤äº’ã€‚</p><p><code>containerd.io</code>: è¿™æ˜¯ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼ŒDocker ç”¨å®ƒæ¥ç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>è¿™ä¸ªå‘½ä»¤å®‰è£…äº† Docker çš„å…¨éƒ¨ä¸»è¦ç»„ä»¶ï¼ŒåŒ…æ‹¬ Docker å¼•æ“ã€å®¢æˆ·ç«¯ç•Œé¢ï¼Œä»¥åŠå®¹å™¨è¿è¡Œæ—¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y docker-ce </span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤åªæ˜¾å¼åœ°å®‰è£…äº† <code>docker-ce</code> åŒ…ï¼Œå³ Docker ç¤¾åŒºç‰ˆçš„æ ¸å¿ƒç»„ä»¶ã€‚</p><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå®‰è£… <code>docker-ce</code> æ—¶ï¼Œç›¸å…³çš„ä¾èµ–åŒ…ï¼ˆå¦‚ <code>docker-ce-cli</code> å’Œ <code>containerd.io</code>ï¼‰ä¼šè‡ªåŠ¨è¢«å®‰è£…ã€‚ä½†å¹¶ä¸å¯é ï¼Œç‰¹åˆ«æ˜¯åœ¨ç‰¹å®šçš„<br>YUM ä»“åº“é…ç½®æˆ–åŒ…ä¾èµ–æ€§å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹ã€‚</p><p>å› æ­¤ï¼Œ<strong>ç¬¬ä¸€ä¸ªå‘½ä»¤æ›´åŠ å…¨é¢</strong>ï¼Œå®ƒç¡®ä¿äº† Docker çš„æ‰€æœ‰ä¸»è¦ç»„ä»¶éƒ½è¢«å®‰è£…ã€‚è€Œç¬¬äºŒä¸ªå‘½ä»¤å¯èƒ½ä¾èµ–äº YUM<br>çš„ä¾èµ–æ€§è§£ææ¥å®‰è£…é¢å¤–çš„å¿…è¦ç»„ä»¶ã€‚ä¸ºäº†ç¡®ä¿å®Œæ•´çš„å®‰è£…ï¼Œé€šå¸¸æ¨èä½¿ç”¨ç¬¬ä¸€ä¸ªå‘½ä»¤</p><h2 id="5-2-ä¸‹è½½æŒ‡å®šç‰ˆæœ¬"><a href="#5-2-ä¸‹è½½æŒ‡å®šç‰ˆæœ¬" class="headerlink" title="5.2 ä¸‹è½½æŒ‡å®šç‰ˆæœ¬"></a>5.2 ä¸‹è½½æŒ‡å®šç‰ˆæœ¬</h2><p>å…ˆæŸ¥çœ‹ç‰ˆæœ¬åˆ—è¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | <span class="built_in">sort</span> -r</span><br></pre></td></tr></table></figure><p>æŒ‡å®šç‰ˆæœ¬å·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce-17.09.0.ce -y</span><br></pre></td></tr></table></figure><h2 id="6-å¯åŠ¨"><a href="#6-å¯åŠ¨" class="headerlink" title="6. å¯åŠ¨"></a>6. å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><h2 id="7-æŸ¥çœ‹ç‰ˆæœ¬"><a href="#7-æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="7. æŸ¥çœ‹ç‰ˆæœ¬"></a>7. æŸ¥çœ‹ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure><h2 id="ä»¥ä¸‹ç‰ˆæœ¬å·æœ‰å•¥åŒºåˆ«ï¼Ÿ"><a href="#ä»¥ä¸‹ç‰ˆæœ¬å·æœ‰å•¥åŒºåˆ«ï¼Ÿ" class="headerlink" title="ä»¥ä¸‹ç‰ˆæœ¬å·æœ‰å•¥åŒºåˆ«ï¼Ÿ"></a>ä»¥ä¸‹ç‰ˆæœ¬å·æœ‰å•¥åŒºåˆ«ï¼Ÿ</h2><p><code>Docker version 1.13.1, build 7d71120/1.13.1</code>ï¼ˆç›´æ¥yumå®‰è£…çš„ï¼‰</p><p><code>Docker version 24.0.7, build afdd53b</code></p><ol><li><p><strong>Docker 1.13.1</strong>ï¼šè¿™æ˜¯ Docker è¾ƒæ—©æœŸçš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå‘å¸ƒäº 2017<br>å¹´å·¦å³ã€‚è¿™ä¸ªç‰ˆæœ¬å·éµå¾ªç€ä¼ ç»Ÿçš„ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·çš„æ ¼å¼ã€‚åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œä¸»ç‰ˆæœ¬å·æ˜¯ <code>1</code>ï¼Œæ¬¡ç‰ˆæœ¬å·æ˜¯ <code>13</code><br>ï¼Œä¿®è®¢å·æ˜¯ <code>1</code>ã€‚<code>build 7d71120/1.13.1</code> è¡¨æ˜è¿™ä¸ªæ„å»ºçš„å…·ä½“æäº¤ ID æ˜¯ <code>7d71120</code>ã€‚</p></li><li><p><strong>Docker 24.0.7</strong>ï¼šè¿™ä¸ªç‰ˆæœ¬å·ä»£è¡¨äº† Docker çš„è¾ƒæ–°ç‰ˆæœ¬ï¼Œå…¶ç‰ˆæœ¬å‘½åæ–¹å¼åœ¨ Docker 17.03 ç‰ˆæœ¬åå‘ç”Ÿäº†å˜åŒ–ã€‚ä» 2017<br>å¹´å¼€å§‹ï¼ŒDocker é‡‡ç”¨å¹´ä»½å’Œæœˆä»½çš„æ–¹å¼æ¥æ ‡è®°ç‰ˆæœ¬ï¼Œæ¯”å¦‚ <code>17.03</code> è¡¨ç¤º 2017 å¹´ 3 æœˆçš„ç‰ˆæœ¬ã€‚ä½†åœ¨æ‚¨æä¾›çš„ç‰ˆæœ¬å·ä¸­ï¼Œ<code>24.0.7</code><br>ä¼¼ä¹å¹¶ä¸éµå¾ªè¿™ä¸ªè§„åˆ™ï¼Œå¯èƒ½æ˜¯ Docker åˆä¸€æ¬¡è°ƒæ•´äº†ç‰ˆæœ¬å‘½åç­–ç•¥ï¼Œæˆ–è€…è¿™æ˜¯ä¸€ä¸ªç‰¹å®šçš„ä¼ä¸šç‰ˆæˆ–å®šåˆ¶ç‰ˆ Docker<br>çš„ç‰ˆæœ¬å·ã€‚<code>build afdd53b</code> åŒæ ·è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬çš„æ„å»º IDã€‚</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flaskè½¯åˆ é™¤æ–¹æ¡ˆ</title>
      <link href="/2023/07/13/flask%E8%BD%AF%E5%88%A0%E9%99%A4%E6%96%B9%E6%A1%88/"/>
      <url>/2023/07/13/flask%E8%BD%AF%E5%88%A0%E9%99%A4%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h2 id="flaskè½¯åˆ é™¤æ–¹æ¡ˆ"><a href="#flaskè½¯åˆ é™¤æ–¹æ¡ˆ" class="headerlink" title="flaskè½¯åˆ é™¤æ–¹æ¡ˆ"></a>flaskè½¯åˆ é™¤æ–¹æ¡ˆ</h2><p>åœ¨æ¨¡å‹å’Œè¡¨ä¸­åŠ å…¥äº†è½¯åˆ é™¤æ ‡è¯†å­—æ®µ <code>is_delete</code>ï¼Œä¸ºäº†å®ç°æŸ¥è¯¢æ—¶è¿‡æ»¤æ‰å·²åˆ é™¤æ•°æ®ï¼Œéœ€è¦åœ¨æ¯ä¸€ä¸ªqueryåæ‰‹å†™filterå‚æ•°(is_delete&#x3D;0)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pagination = DemoModel.query.filter_by(is_delete=<span class="number">0</span>).paginate(page=<span class="number">1</span>, per_page=<span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é¿å…é‡å¤çš„æ˜¾å¼çš„è¿‡æ»¤æŸ¥è¯¢ï¼Œå¯ä»¥ç»§æ‰¿æ”¹å†™<code>BaseQuery</code>åŸºç±»ï¼Œå°†<code>is_delete</code>çš„è¿‡æ»¤æ“ä½œæ”¾åœ¨åº•å±‚ï¼Œå®ç°é¢„è¿‡æ»¤ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> BaseQuery</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QueryWithSoftDelete</span>(<span class="title class_ inherited__">BaseQuery</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        obj = <span class="built_in">super</span>(QueryWithSoftDelete, cls).__new__(cls)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(args) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">super</span>(QueryWithSoftDelete, obj).__init__(*args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> obj.filter_by(is_delete=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure><blockquote><p>(è¿™ä¸ª<code>BaseQuery</code>å¹¶ä¸æ˜¯ä»<code>sqlalchemy</code>å¯¼å…¥çš„ï¼Œè€Œæ˜¯<code>flask_sqlalchemy</code>â€¦.)</p></blockquote><p>ç„¶åæ¯ä¸€ä¸ªæ¨¡å‹éƒ½æ·»åŠ <code>query_class = QueryWithSoftDelete</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªmodelçš„æŸ¥è¯¢åŸºç±»ä½¿ç”¨<code>QueryWithSoftDelete</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> custom.models.custom_query <span class="keyword">import</span> QueryWithSoftDelete</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DemoModel</span>(db.Model):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;demo&#x27;</span></span><br><span class="line">    ...</span><br><span class="line">    query_class = QueryWithSoftDelete</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">soft_delete</span>(<span class="params">self</span>):</span><br><span class="line">        self.is_delete = time.time()</span><br><span class="line">        <span class="keyword">return</span> self.is_delete</span><br></pre></td></tr></table></figure><p><code>soft_delete</code>æ–¹æ³•ç”¨äºè½¯åˆ é™¤ï¼Œå°†<code>is_delete</code>å­—æ®µè®¾ç½®ä¸ºå½“å‰æ—¶é—´æˆ³ï¼Œè¡¨ç¤ºåˆ é™¤æ—¶é—´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obj = DemoModel.query.filter_by(obj_uuid=<span class="number">1</span>).first()</span><br><span class="line">obj.soft_delete()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mongoæŠ•å½±</title>
      <link href="/2023/04/29/mongo%E6%8A%95%E5%BD%B1/"/>
      <url>/2023/04/29/mongo%E6%8A%95%E5%BD%B1/</url>
      
        <content type="html"><![CDATA[<h2 id="æŠ•å½±ï¼ˆProjectionï¼‰"><a href="#æŠ•å½±ï¼ˆProjectionï¼‰" class="headerlink" title="æŠ•å½±ï¼ˆProjectionï¼‰"></a>æŠ•å½±ï¼ˆProjectionï¼‰</h2><p>åœ¨ MongoDB ä¸­ï¼ŒæŸ¥è¯¢æ“ä½œä¸­çš„æŠ•å½±ï¼ˆProjectionï¼‰å¯ä»¥æ§åˆ¶è¿”å›ç»“æœä¸­åŒ…å«çš„å­—æ®µã€‚é€šè¿‡ä½¿ç”¨æŠ•å½±æ§åˆ¶è¿”å›å­—æ®µï¼Œä»è€Œå‡å°‘æ•°æ®ä¼ è¾“å’Œå¤„ç†çš„å¼€é”€ã€‚</p><p>åœ¨ç¼–å†™æŸ¥è¯¢è¯­å¥æ—¶ï¼ŒæŠ•å½±çš„å†™æ³•æœ‰ä»¥ä¸‹å‡ ç‚¹è®²ç©¶ï¼š</p><ol><li><strong>æŒ‡å®šåŒ…å«çš„å­—æ®µæˆ–æ’é™¤çš„å­—æ®µï¼š</strong> å¯ä»¥ä½¿ç”¨ 1 è¡¨ç¤ºè¦åŒ…å«è¯¥å­—æ®µï¼Œä½¿ç”¨ 0 è¡¨ç¤ºè¦æ’é™¤è¯¥å­—æ®µã€‚åœ¨æŠ•å½±ä¸­æŒ‡å®šè¦è¿”å›çš„å­—æ®µï¼Œå¯ä»¥å‡å°‘è¿”å›ç»“æœçš„æ•°æ®é‡ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</li><li><strong>ä½¿ç”¨ä¸‹åˆ’çº¿ _idï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ï¼ŒMongoDB åœ¨æ¯ä¸ªæ–‡æ¡£ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªåä¸º _id çš„å­—æ®µï¼Œå®ƒå”¯ä¸€æ ‡è¯†äº†è¯¥æ–‡æ¡£ã€‚åœ¨æŠ•å½±ä¸­ï¼Œå¦‚æœä¸æƒ³è¿”å› _id å­—æ®µï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸º 0ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯ä¸€äº›æŠ•å½±çš„å¸¸è§å†™æ³•ç¤ºä¾‹ï¼š</p><ul><li>è¿”å›æŒ‡å®šå­—æ®µï¼Œæ’é™¤å…¶ä»–å­—æ®µï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">projection = &#123;</span><br><span class="line">    <span class="string">&quot;field1&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;field2&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ’é™¤æŒ‡å®šå­—æ®µï¼Œè¿”å›å…¶ä»–å­—æ®µï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">projection = &#123;</span><br><span class="line">    <span class="string">&quot;field1&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;field2&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;field3&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿”å›æ‰€æœ‰å­—æ®µï¼ˆé»˜è®¤æƒ…å†µï¼Œå¯ä»¥çœç•¥æŠ•å½±ï¼‰ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">projection = &#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿”å›é™¤æŒ‡å®šå­—æ®µå¤–çš„æ‰€æœ‰å­—æ®µï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">projection = &#123;</span><br><span class="line">    <span class="string">&quot;excluded_field&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> mongo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerå®¹å™¨è‡ªå¯åŠ¨</title>
      <link href="/2022/09/11/docker%E5%AE%B9%E5%99%A8%E8%87%AA%E5%90%AF%E5%8A%A8/"/>
      <url>/2022/09/11/docker%E5%AE%B9%E5%99%A8%E8%87%AA%E5%90%AF%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<p>å…ˆæŸ¥çœ‹æ˜¯å¦å·²ç»è®¾ç½®äº†è‡ªå¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect å®¹å™¨ID</span><br></pre></td></tr></table></figure><p>åœ¨è¾“å‡ºä¸­ï¼Œæ‰¾åˆ° â€œRestartPolicyâ€ ï¼Œå®ƒä¼šæ˜¾ç¤ºå®¹å™¨çš„é‡å¯ç­–ç•¥ã€‚å¦‚æœå€¼æ˜¯ â€œalwaysâ€ï¼Œé‚£ä¹ˆè¯´æ˜è¯¥å®¹å™¨å·²è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;RestartPolicy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;always&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;MaximumRetryCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®ä¸ºalways</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker update --restart=always [å®¹å™¨åç§°æˆ–ID]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç´¯ç§¯æƒé‡æŠ½æ ·demoåŠæ–¹æ¡ˆåˆ†æ</title>
      <link href="/2022/06/18/%E7%B4%AF%E7%A7%AF%E6%9D%83%E9%87%8D%E6%8A%BD%E6%A0%B7demo%E5%8F%8A%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90/"/>
      <url>/2022/06/18/%E7%B4%AF%E7%A7%AF%E6%9D%83%E9%87%8D%E6%8A%BD%E6%A0%B7demo%E5%8F%8A%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 2021-12-18 19:00:00</span></span><br><span class="line"><span class="comment"># @Author : wangkaiyu</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">channel_choose</span>(<span class="params">channel_weights</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> channel_weights:</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç´¯ç§¯æƒé‡åˆ—è¡¨</span></span><br><span class="line">    cumulative_weights = []</span><br><span class="line">    total_weight = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> channel_weights:</span><br><span class="line">        weight = item.get(<span class="string">&quot;weight&quot;</span>, <span class="number">0</span>)</span><br><span class="line">        total_weight += weight</span><br><span class="line">        cumulative_weights.append(total_weight)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ‰€æœ‰æ¸ é“çš„æƒé‡å’Œä¸º0ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ¸ é“æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> total_weight == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> channel_weights[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”Ÿæˆä¸€ä¸ª0åˆ°æ€»æƒé‡çš„éšæœºæ•°</span></span><br><span class="line">    rand_val = random.random() * total_weight</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æŸ¥æ‰¾éšæœºæ•°æ‰€åœ¨çš„æƒé‡èŒƒå›´</span></span><br><span class="line">    <span class="keyword">for</span> index, cum_weight <span class="keyword">in</span> <span class="built_in">enumerate</span>(cumulative_weights):</span><br><span class="line">        <span class="keyword">if</span> rand_val &lt; cum_weight:</span><br><span class="line">            <span class="keyword">return</span> channel_weights[index]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    data = [&#123;<span class="string">&quot;weight&quot;</span>: <span class="number">100</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;DDOS&quot;</span>&#125;, &#123;<span class="string">&quot;weight&quot;</span>: <span class="number">50000</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;WAF&quot;</span>&#125;]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æŠ½æ ·ç»“æœï¼š&quot;</span>, channel_choose(data))</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    total_time = end_time - start_time</span><br><span class="line">    total_time_s = <span class="built_in">format</span>(total_time, <span class="string">&#x27;.10f&#x27;</span>)</span><br><span class="line">    total_time_ms = <span class="built_in">format</span>(total_time * <span class="number">1000</span>, <span class="string">&#x27;.2f&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¿è¡Œæ—¶é—´ï¼š<span class="subst">&#123;total_time_s&#125;</span>s   --&gt;  <span class="subst">&#123;total_time_ms&#125;</span>ms&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><h3 id="é¦–å…ˆ"><a href="#é¦–å…ˆ" class="headerlink" title="é¦–å…ˆ"></a>é¦–å…ˆ</h3><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œå…ˆçœ‹ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬æœ‰3ä¸ªæ¸ é“ï¼Œæƒé‡åˆ†åˆ«ä¸º<code>3</code>, <code>2</code>, å’Œ<code>5</code>ã€‚å¦‚æœæˆ‘ä»¬å°†è¿™äº›æƒé‡ç»˜åˆ¶åˆ°ä¸€æ¡ç›´çº¿ä¸Šï¼Œå¯ä»¥æƒ³è±¡æˆè¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| ---A - -- | ---B - -- | ----------C - --------- |</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>A</code>ä»£è¡¨ç¬¬ä¸€ä¸ªæ¸ é“ï¼Œå®ƒå 3ä¸ªå•ä½é•¿åº¦ï¼›<code>B</code>ä»£è¡¨ç¬¬äºŒä¸ªï¼Œå®ƒå 2ä¸ªå•ä½ï¼›<code>C</code><br>ä»£è¡¨ç¬¬ä¸‰ä¸ªï¼Œå®ƒå 5ä¸ªå•ä½ã€‚æ•´æ¡çº¿çš„æ€»é•¿åº¦æ˜¯<code>3 + 2 + 5 = 10</code>ã€‚</p><p>å½“æˆ‘ä»¬åœ¨è¿™æ¡é•¿åº¦ä¸º10çš„çº¿ä¸Šéšæœºé€‰æ‹©ä¸€ä¸ªç‚¹ï¼Œè½åœ¨<code>A</code>ã€<code>B</code>ã€æˆ–<code>C</code>çš„åŒºé—´å†…çš„æ¦‚ç‡åˆ†åˆ«ä¸º<code>3/10</code>ã€<code>2/10</code>ã€å’Œ<code>5/10</code>ï¼Œè¿™ä¸å®ƒä»¬çš„æƒé‡æ˜¯ä¸€è‡´çš„ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸å¿…çœŸçš„ç”»è¿™æ ·çš„çº¿ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå«åšâ€œç´¯ç§¯æƒé‡â€çš„åˆ—è¡¨æ¥ä»£æ›¿ã€‚</p><p>å¯¹äºæˆ‘ä»¬çš„ä¾‹å­ï¼Œç´¯ç§¯æƒé‡åˆ—è¡¨æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">3</span>, <span class="number">5</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•è®¡ç®—çš„ï¼Ÿ"><a href="#å¦‚ä½•è®¡ç®—çš„ï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¡ç®—çš„ï¼Ÿ"></a>å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</h3><ul><li>ç¬¬ä¸€ä¸ªæ•°æ˜¯ç¬¬ä¸€ä¸ªæ¸ é“çš„æƒé‡ï¼š3</li><li>ç¬¬äºŒä¸ªæ•°æ˜¯å‰ä¸¤ä¸ªæ¸ é“æƒé‡çš„å’Œï¼š3 + 2 &#x3D; 5</li><li>ç¬¬ä¸‰ä¸ªæ•°æ˜¯æ‰€æœ‰æ¸ é“æƒé‡çš„å’Œï¼š3 + 2 + 5 &#x3D; 10</li></ul><p>å½“æˆ‘ä»¬äº§ç”Ÿä¸€ä¸ª<code>0~10</code>ä¹‹é—´çš„éšæœºæ•°ï¼š</p><ul><li>å¦‚æœè¿™ä¸ªæ•°å°äº3ï¼Œæˆ‘ä»¬é€‰æ‹©<code>A</code>ã€‚</li><li>å¦‚æœè¿™ä¸ªæ•°å°äº5ä½†å¤§äºæˆ–ç­‰äº3ï¼Œæˆ‘ä»¬é€‰æ‹©<code>B</code>ã€‚</li><li>å¦‚æœè¿™ä¸ªæ•°å°äº10ä½†å¤§äºæˆ–ç­‰äº5ï¼Œæˆ‘ä»¬é€‰æ‹©<code>C</code>ã€‚</li></ul><p>è¿™æ ·å°±æ¨¡æ‹Ÿäº†åŸºäºæƒé‡çš„éšæœºé€‰æ‹©ï¼Œè€Œæ²¡æœ‰å¿…è¦åˆ›å»ºä¸€ä¸ªå·¨å¤§çš„unwind_listã€‚</p><h2 id="ä»£ç é€»è¾‘ï¼š"><a href="#ä»£ç é€»è¾‘ï¼š" class="headerlink" title="ä»£ç é€»è¾‘ï¼š"></a>ä»£ç é€»è¾‘ï¼š</h2><ol><li>åˆå§‹åŒ–<code>cumulative_weights</code>ä¸ºç©ºåˆ—è¡¨å’Œ<code>total_weight</code>ä¸º0ã€‚</li><li>éå†<code>channel_weights</code>ï¼Œå¯¹æ¯ä¸ªæ¸ é“ï¼Œå°†å…¶æƒé‡åŠ åˆ°<code>total_weight</code>ï¼Œç„¶åå°†<code>total_weight</code>æ·»åŠ åˆ°<code>cumulative_weights</code>ã€‚</li><li>äº§ç”Ÿä¸€ä¸ª<code>0~total_weight</code>ä¹‹é—´çš„éšæœºæ•°ã€‚</li><li>æŸ¥æ‰¾è¿™ä¸ªéšæœºæ•°å±äºå“ªä¸ªæ¸ é“çš„èŒƒå›´ï¼Œå¹¶è¿”å›é‚£ä¸ªæ¸ é“ã€‚</li></ol><p>è¿™ç§æ–¹æ³•æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºä¸éœ€è¦ä¸ºæ¯ä¸ªæ¸ é“æŒ‰å…¶æƒé‡æ•°åˆ›å»ºå¤šä¸ªæ¡ç›®ï¼Œè€Œåªéœ€è¦åšä¸€äº›ç®€å•çš„æ•°å­¦è®¡ç®—å’ŒæŸ¥æ‰¾æ“ä½œã€‚</p><h2 id="å¦‚ä½•ç”Ÿæˆä¸€ä¸ª0-æœ€å¤§æƒé‡ä¹‹é—´çš„éšæœºæ•°ï¼Ÿ"><a href="#å¦‚ä½•ç”Ÿæˆä¸€ä¸ª0-æœ€å¤§æƒé‡ä¹‹é—´çš„éšæœºæ•°ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç”Ÿæˆä¸€ä¸ª0~æœ€å¤§æƒé‡ä¹‹é—´çš„éšæœºæ•°ï¼Ÿ"></a>å¦‚ä½•ç”Ÿæˆä¸€ä¸ª0~æœ€å¤§æƒé‡ä¹‹é—´çš„éšæœºæ•°ï¼Ÿ</h2><p>åœ¨Pythonä¸­ï¼Œ<code>random.random()</code>ä¼šè¿”å›ä¸€ä¸ªåœ¨[0, 1)èŒƒå›´å†…çš„æµ®ç‚¹æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå¤§äºæˆ–ç­‰äº0ä¸”å°äº1çš„éšæœºæ•°ã€‚</p><p>ä¸ºäº†å¾—åˆ°ä¸€ä¸ªåœ¨[0, <code>total_weight</code>)èŒƒå›´å†…çš„éšæœºæ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†<code>random.random()</code>çš„ç»“æœä¹˜ä»¥<code>total_weight</code>ã€‚</p><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è§£é‡Šï¼š</p><p>å‡è®¾<code>total_weight</code>ä¸º10ï¼Œé‚£ä¹ˆ<code>random.random()</code>å¯èƒ½ä¼šè¿”å›å¦‚ä¸‹ä¸€äº›å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.123</span>, <span class="number">0.456</span>, <span class="number">0.789</span>, ...</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å°†è¿™äº›å€¼ä¹˜ä»¥<code>total_weight</code>ï¼ˆå³10ï¼‰æ—¶ï¼Œå¾—åˆ°çš„æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.23</span>, <span class="number">4.56</span>, <span class="number">7.89</span>, ...</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªåœ¨[0, 10)èŒƒå›´å†…çš„éšæœºæµ®ç‚¹æ•°ã€‚</p><p>åœ¨ä¸Šé¢æåˆ°çš„<code>channel_choose</code>å‡½æ•°ä¸­ï¼Œè¿™ä¸€æ­¥æ˜¯è¿™æ ·å®ç°çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rand_val = random.random() * total_weight</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>rand_val</code>å°±æ˜¯ä¸€ä¸ªåœ¨[0, <code>total_weight</code>)èŒƒå›´å†…çš„éšæœºæ•°ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨random-random-æ€»æƒé‡ï¼Œè€Œä¸æ˜¯ç›´æ¥å–0åˆ°æ€»æƒé‡ä¹‹é—´çš„éšæœºæ•°å‘¢ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨random-random-æ€»æƒé‡ï¼Œè€Œä¸æ˜¯ç›´æ¥å–0åˆ°æ€»æƒé‡ä¹‹é—´çš„éšæœºæ•°å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨random.random()*æ€»æƒé‡ï¼Œè€Œä¸æ˜¯ç›´æ¥å–0åˆ°æ€»æƒé‡ä¹‹é—´çš„éšæœºæ•°å‘¢ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨random.random()*æ€»æƒé‡ï¼Œè€Œä¸æ˜¯ç›´æ¥å–0åˆ°æ€»æƒé‡ä¹‹é—´çš„éšæœºæ•°å‘¢ï¼Ÿ</h2><p>åœ¨åŸå§‹ä»£ç ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªå±•å¼€çš„åˆ—è¡¨(<code>unwind_list</code>)</p><p>æ‰€ä»¥ä½¿ç”¨<code>random.randint(0, int(total_weight) - 1)</code>æ˜¯åˆé€‚çš„ï¼Œå› ä¸ºæ˜¯åœ¨ä¸€ä¸ªæ•´æ•°ç´¢å¼•èŒƒå›´å†…é€‰æ‹©ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ€»æƒé‡ä¸º10ï¼Œé‚£ä¹ˆä½ ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæ•´æ•°ï¼ŒèŒƒå›´ä»0åˆ°9ã€‚</p><p>ä½†åœ¨åŸºäºç´¯ç§¯æƒé‡çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å±•å¼€çš„åˆ—è¡¨ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç›´æ¥åœ¨æƒé‡çš„è¿ç»­èŒƒå›´å†…é€‰æ‹©ã€‚ä½¿ç”¨<code>random.random() * total_weight</code><br>çš„åŸå› åœ¨äºæˆ‘ä»¬æƒ³è·å–ä¸€ä¸ªè¿ç»­çš„æ•°å€¼èŒƒå›´è€Œä¸ä»…ä»…æ˜¯æ•´æ•°ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥æ›´å¹³æ»‘åœ°å¤„ç†æƒé‡ï¼Œå°¤å…¶æ˜¯å½“æƒé‡ä¸æ˜¯æ•´æ•°æ—¶ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªæ¸ é“ï¼Œæƒé‡åˆ†åˆ«æ˜¯1.5å’Œ2.5ï¼Œé‚£ä¹ˆæ€»æƒé‡æ˜¯4ã€‚å¦‚æœæˆ‘ä»¬åªéšæœºé€‰æ‹©ä¸€ä¸ªæ•´æ•°ï¼Œæˆ‘ä»¬åªèƒ½åœ¨0ã€1ã€2ã€3ä¹‹ä¸­é€‰æ‹©ï¼Œè¿™å°±ä¸å¤Ÿç²¾ç¡®ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸäº›æ¸ é“è¢«è¿‡åº¦é€‰æ‹©æˆ–è€…è¢«å¿½ç•¥ã€‚</p><p>ä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>random.random() * total_weight</code>ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªä»0åˆ°4ä¹‹é—´çš„æµ®ç‚¹æ•°ï¼ˆå¦‚1.23ã€2.78ç­‰ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥æ›´ç²¾ç¡®åœ°åæ˜ æƒé‡ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœç¡®ä¿ä½ çš„æƒé‡å§‹ç»ˆæ˜¯æ•´æ•°ï¼Œå¹¶ä¸”æƒ³ç»§ç»­ä½¿ç”¨æ•´æ•°éšæœºæ•°ï¼Œé‚£ä¹ˆä½¿ç”¨<code>random.randint(0, total_weight - 1)</code>ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½†ä½¿ç”¨<code>random.random() * total_weight</code>æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œå¹¶ä¸”å¯ä»¥æ›´å‡†ç¡®åœ°å¤„ç†ä¸åŒçš„æƒé‡æƒ…å†µã€‚</p><h2 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><h3 id="ä»€ä¹ˆæƒ…å†µä¸‹æƒé‡æ•°ä¼šå˜å¾—å¾ˆå¤§ï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹æƒé‡æ•°ä¼šå˜å¾—å¾ˆå¤§ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹æƒé‡æ•°ä¼šå˜å¾—å¾ˆå¤§ï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µä¸‹æƒé‡æ•°ä¼šå˜å¾—å¾ˆå¤§ï¼Ÿ</h3><ol><li><strong>å¤§æ•°æ®é›†</strong>ï¼šä¾‹å¦‚ï¼Œå½“å¤„ç†ä¸€ä¸ªå¤§å‹çš„å¹¿å‘Šå¹³å°æˆ–å†…å®¹æ¨èç³»ç»Ÿæ—¶ï¼Œå¯èƒ½æœ‰æ•°ç™¾ä¸‡çš„é¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½æœ‰è‡ªå·±çš„æƒé‡ã€‚</li><li><strong>é«˜ç²¾åº¦æƒé‡</strong>ï¼šåœ¨æŸäº›åº”ç”¨ä¸­ï¼Œä¸ºäº†å®ç°é«˜ç²¾ç¡®åº¦çš„æƒé‡åˆ†é…ï¼Œæƒé‡å¯èƒ½ä¼šè¢«è®¾ç½®ä¸ºéå¸¸å¤§çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œä»£æ›¿ä½¿ç”¨0.1å’Œ0.9ä½œä¸ºæƒé‡ï¼Œå¯èƒ½ä¼šä½¿ç”¨100å’Œ900ä»¥è·å¾—æ›´å¥½çš„æ§åˆ¶ã€‚</li><li><strong>æƒé‡çš„ç´¯è®¡æˆ–å åŠ </strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæƒé‡å¯èƒ½ä¼šåŸºäºå„ç§æ ‡å‡†æˆ–æŒ‡æ ‡è¿›è¡Œç´¯åŠ æˆ–ä¹˜æ³•å åŠ ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™å¯èƒ½å¯¼è‡´éå¸¸å¤§çš„æƒé‡ã€‚</li><li><strong>è‡ªç„¶å¢é•¿</strong>ï¼šä¾‹å¦‚ï¼Œåœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œé¡¹ç›®å¯èƒ½åŸºäºå…¶å­˜åœ¨çš„æ—¶é—´æˆ–å…¶å—æ¬¢è¿ç¨‹åº¦è·å¾—æ›´å¤šçš„æƒé‡ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™äº›æƒé‡å¯èƒ½ä¼šä¸æ–­å¢é•¿ã€‚</li><li><strong>äººä¸ºè®¾ç½®</strong>ï¼šåœ¨æŸäº›åº”ç”¨ä¸­ï¼Œä¸ºäº†ä½¿æŸäº›é¡¹ç›®å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§æˆ–å¯è§æ€§ï¼Œç®¡ç†å‘˜æˆ–ç”¨æˆ·å¯èƒ½ä¼šäººä¸ºåœ°è®¾ç½®éå¸¸å¤§çš„æƒé‡ã€‚</li><li><strong>ç¼ºä¹å½’ä¸€åŒ–æˆ–è§„èŒƒåŒ–</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæƒé‡å¯èƒ½æ²¡æœ‰ç»è¿‡é€‚å½“çš„å½’ä¸€åŒ–æˆ–è§„èŒƒåŒ–å¤„ç†ï¼Œå¯¼è‡´å…¶å€¼è¿œå¤§äºé¢„æœŸã€‚</li></ol><p>å¯¹äºä»»ä½•å…·æœ‰æƒé‡çš„ç³»ç»Ÿæˆ–åº”ç”¨ï¼Œå®šæœŸå®¡æŸ¥å’Œç®¡ç†æƒé‡æ˜¯å¾ˆé‡è¦çš„ï¼Œä»¥ç¡®ä¿æƒé‡çš„åˆ†é…ä»ç„¶åˆç†å¹¶ç¬¦åˆé¢„æœŸçš„ç›®çš„ã€‚å¦‚æœå‘ç°æƒé‡å˜å¾—å¤ªå¤§ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘é‡æ–°è°ƒæ•´ã€å½’ä¸€åŒ–æˆ–ä½¿ç”¨å…¶ä»–æŠ€æœ¯æ¥ç®¡ç†è¿™äº›æƒé‡ã€‚</p><h3 id="å’Œä¸Šä¸€ç¯‡å±•å¼€å¼å®ç°æ–¹æ¡ˆçš„å·®å¼‚"><a href="#å’Œä¸Šä¸€ç¯‡å±•å¼€å¼å®ç°æ–¹æ¡ˆçš„å·®å¼‚" class="headerlink" title="å’Œä¸Šä¸€ç¯‡å±•å¼€å¼å®ç°æ–¹æ¡ˆçš„å·®å¼‚"></a>å’Œä¸Šä¸€ç¯‡å±•å¼€å¼å®ç°æ–¹æ¡ˆçš„å·®å¼‚</h3><p>è¿™ä¸¤ç§å®ç°æ–¹æ¡ˆï¼Œç›®çš„éƒ½æ˜¯æ ¹æ®æƒé‡å¯¹ä¸€ç»„æ•°æ®è¿›è¡ŒéšæœºæŠ½æ ·ã€‚</p><ol><li><strong>å±•å¼€æŠ½æ ·</strong>ï¼šä½¿ç”¨â€å±•å¼€â€çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®æ¯ä¸ªæ¸ é“çš„æƒé‡åœ¨<code>unwind_list</code>ä¸­é‡å¤è¯¥æ¸ é“ã€‚æƒé‡å¤§çš„æ¸ é“åœ¨<code>unwind_list</code><br>ä¸­å‡ºç°çš„æ¬¡æ•°æ›´å¤šï¼Œå› æ­¤è¢«éšæœºé€‰æ‹©çš„æ¦‚ç‡æ›´å¤§ã€‚</li><li><strong>ç´¯ç§¯æƒé‡æŠ½æ ·</strong><br>ï¼šé€šè¿‡ä½¿ç”¨ç´¯ç§¯æƒé‡å’Œä¸€ä¸ªè¿ç»­èŒƒå›´å†…çš„éšæœºæ•°æ¥ç¡®å®šåº”é€‰æ‹©å“ªä¸ªæ¸ é“ã€‚è¿™ç§æ–¹å¼é¿å…äº†åˆ›å»ºä¸€ä¸ªå¯èƒ½éå¸¸å¤§çš„<code>unwind_list</code><br>ï¼Œå°¤å…¶æ˜¯å½“æƒé‡éå¸¸å¤§æ—¶ã€‚</li></ol><p>ä½†ä¸è®ºå“ªç§æ–¹å¼ï¼Œæ ¸å¿ƒæ€æƒ³éƒ½æ˜¯ï¼š<em><strong>ç¡®ä¿æ¯ä¸ªæ¸ é“è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸å…¶æƒé‡æˆæ­£æ¯”ã€‚</strong></em></p><h2 id="CDFç´¯ç§¯åˆ†å¸ƒå‡½æ•°"><a href="#CDFç´¯ç§¯åˆ†å¸ƒå‡½æ•°" class="headerlink" title="CDFç´¯ç§¯åˆ†å¸ƒå‡½æ•°"></a>CDFç´¯ç§¯åˆ†å¸ƒå‡½æ•°</h2><p>åŸºäºç´¯ç§¯æƒé‡è¿›è¡Œéšæœºé€‰æ‹©ï¼Œé€šå¸¸è¢«ç§°ä¸ºç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCDF, Cumulative Distribution Functionï¼‰çš„éšæœºæŠ½æ ·æ–¹æ³•ã€‚</p><p>åœ¨ç»Ÿè®¡å­¦ä¸­ï¼ŒCDFæè¿°äº†ä¸€ä¸ªå®æ•°éšæœºå˜é‡çš„æ¦‚ç‡åˆ†å¸ƒã€‚å¯¹äºç¦»æ•£éšæœºå˜é‡ï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„æ¸ é“ï¼‰ï¼ŒCDFè¡¨ç¤ºå€¼å°äºæˆ–ç­‰äºæŸä¸ªç»™å®šå€¼çš„æ¦‚ç‡ã€‚é€šè¿‡ä½¿ç”¨ç´¯ç§¯æƒé‡åˆ—è¡¨å’ŒéšæœºæŠ½æ ·ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯ä»ç¦»æ•£çš„CDFä¸­è¿›è¡ŒæŠ½æ ·ã€‚</p><p>å› æ­¤ï¼Œè¿™ç§æ–¹æ¡ˆå¯ä»¥ç§°ä¹‹ä¸º<code>åŸºäºCDFçš„æƒé‡éšæœºæŠ½æ ·ç®—æ³•</code>æˆ–ç®€ç§°<code>CDFéšæœºæŠ½æ ·</code>ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ æƒéšæœºæŠ½æ ·demoåŠæ–¹æ¡ˆåˆ†æ</title>
      <link href="/2022/06/17/%E5%8A%A0%E6%9D%83%E9%9A%8F%E6%9C%BA%E6%8A%BD%E6%A0%B7demo%E5%8F%8A%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90/"/>
      <url>/2022/06/17/%E5%8A%A0%E6%9D%83%E9%9A%8F%E6%9C%BA%E6%8A%BD%E6%A0%B7demo%E5%8F%8A%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 2021-12-17 18:00:00</span></span><br><span class="line"><span class="comment"># @Author : wangkaiyu</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">channel_choose</span>(<span class="params">channel_weights</span>):</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–æ€»æƒé‡</span></span><br><span class="line">    total_weight = <span class="number">0</span></span><br><span class="line">    <span class="comment"># ç”¨äºæŒ‰æƒé‡å±•å¼€æ•°æ®</span></span><br><span class="line">    unwind_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> channel_weights:</span><br><span class="line">        <span class="comment"># è·å–å½“å‰æ¸ é“çš„æƒé‡ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šæƒé‡ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line">        weight = <span class="built_in">int</span>(item.get(<span class="string">&quot;weight&quot;</span>, <span class="number">0</span>))</span><br><span class="line">        total_weight += weight</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(weight):</span><br><span class="line">            unwind_list.append(item)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> total_weight == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> channel_weights[<span class="number">0</span>] <span class="keyword">if</span> channel_weights <span class="keyword">else</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åœ¨0åˆ°æ€»æƒé‡-1ä¹‹é—´ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°</span></span><br><span class="line">    ran_weight = random.randint(<span class="number">0</span>, <span class="built_in">int</span>(total_weight) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—unwind_listä¸­æ¯ä¸ªæ•°æ®çš„å‡ºç°æ¬¡æ•°</span></span><br><span class="line">    data_count = Counter(item[<span class="string">&#x27;content&#x27;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> unwind_list)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Data Count:&quot;</span>, data_count)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿”å›unwind_listä¸­å¯¹åº”éšæœºæƒé‡çš„æ¸ é“</span></span><br><span class="line">    <span class="keyword">return</span> unwind_list[<span class="built_in">int</span>(ran_weight)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    data = [&#123;<span class="string">&quot;weight&quot;</span>: <span class="number">100</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;DDOS&quot;</span>&#125;, &#123;<span class="string">&quot;weight&quot;</span>: <span class="number">50000</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;WAF&quot;</span>&#125;]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æŠ½æ ·ç»“æœï¼š&quot;</span>, channel_choose(data))</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    total_time = end_time - start_time</span><br><span class="line">    total_time_s = <span class="built_in">format</span>(total_time, <span class="string">&#x27;.10f&#x27;</span>)</span><br><span class="line">    total_time_ms = <span class="built_in">format</span>(total_time * <span class="number">1000</span>, <span class="string">&#x27;.2f&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;è¿è¡Œæ—¶é—´ï¼š<span class="subst">&#123;total_time_s&#125;</span>s   --&gt;  <span class="subst">&#123;total_time_ms&#125;</span>ms&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><p>ä½¿ç”¨â€œå±•å¼€â€çš„æ–¹æ³•æ¥å®ç°åŸºäºæƒé‡çš„éšæœºé€‰æ‹©ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒé¦–å…ˆå°†æ¯ä¸ªæ¸ é“æŒ‰å…¶æƒé‡æ•°â€œå¤åˆ¶â€åˆ°ä¸€ä¸ªæ–°çš„åˆ—è¡¨ä¸­ï¼Œç„¶åä»è¿™ä¸ªâ€œå±•å¼€â€åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ã€‚è¿™æ ·ï¼Œæƒé‡è¾ƒå¤§çš„æ¸ é“åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„æ¬¡æ•°å°±è¶Šå¤šï¼Œå› æ­¤è¢«é€‰ä¸­çš„æ¦‚ç‡ä¹Ÿè¶Šå¤§ã€‚</p><p>è¯¦ç»†å·¥ä½œæ­¥éª¤ï¼š</p><ol><li>åˆå§‹åŒ–ï¼š<ul><li><code>total_weight</code>ä¸º2ï¼ˆä½†è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œåº”è¯¥åˆå§‹åŒ–ä¸º0ï¼‰ã€‚</li><li><code>unwind_list</code>ä¸ºç©ºåˆ—è¡¨ã€‚</li></ul></li><li>å¯¹<code>channel_weights</code>ä¸­çš„æ¯ä¸ªæ¸ é“æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<ul><li>è·å–è¯¥æ¸ é“çš„æƒé‡ï¼›å¦‚æœæœªå®šä¹‰æƒé‡ï¼Œåˆ™é»˜è®¤ä¸º0ã€‚</li><li>å°†å½“å‰çš„æƒé‡ç´¯åŠ åˆ°<code>total_weight</code>ã€‚</li><li>æ ¹æ®å½“å‰æ¸ é“çš„æƒé‡ï¼Œå°†è¿™ä¸ªæ¸ é“å¤šæ¬¡ï¼ˆç­‰äºå…¶æƒé‡ï¼‰æ·»åŠ åˆ°<code>unwind_list</code>ã€‚</li></ul></li><li>åˆ¤æ–­<code>total_weight</code>æ˜¯å¦ä¸º0ï¼š<ul><li>å¦‚æœä¸º0ï¼Œè¿™å¯èƒ½æ„å‘³ç€é…ç½®å­˜åœ¨é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç ç›´æ¥è¿”å›<code>channel_weights</code>ä¸­çš„ç¬¬ä¸€ä¸ªæ¸ é“æˆ–ç©ºå­—å…¸ï¼ˆå¦‚æœåˆ—è¡¨ä¸ºç©ºï¼‰ã€‚</li></ul></li><li>ç”Ÿæˆä¸€ä¸ªä»‹äº0åˆ°<code>total_weight-1</code>çš„éšæœºæ•´æ•°<code>ran_weight</code>ã€‚</li><li>è¿”å›<code>unwind_list</code>åˆ—è¡¨ä¸­ç´¢å¼•ä¸º<code>ran_weight</code>çš„å…ƒç´ ã€‚</li></ol><h2 id="ä¸¾ä¾‹è¯´æ˜"><a href="#ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="ä¸¾ä¾‹è¯´æ˜"></a>ä¸¾ä¾‹è¯´æ˜</h2><p>å‡è®¾æœ‰ä¸¤ä¸ªæ¸ é“ï¼Œæƒé‡åˆ†åˆ«ä¸º2å’Œ3ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel_weights = [&#123;<span class="string">&quot;weight&quot;</span>: <span class="number">2</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;A&quot;</span>&#125;, &#123;<span class="string">&quot;weight&quot;</span>: <span class="number">3</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;B&quot;</span>&#125;]</span><br></pre></td></tr></table></figure><p>unwind_listå°†ä¼šæ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[A, A, B, B, B]</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºéå¸¸å¤§çš„æƒé‡ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œå› ä¸ºå®ƒéœ€è¦åˆ›å»ºä¸€ä¸ªâ€œå±•å¼€â€åˆ—è¡¨ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦å…¶ä»–æ›´é«˜æ•ˆçš„æ–¹æ³•æ¥å®ç°åŸºäºæƒé‡çš„éšæœºé€‰æ‹©ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonä¸­çš„æ­£åˆ™è¡¨è¾¾å¼</title>
      <link href="/2022/01/20/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2022/01/20/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå¤„ç†å­—ç¬¦ä¸²çš„å·¥å…·ã€‚pythonå†…ç½®çš„æ­£åˆ™çš„æ¨¡å—å«åšre</p><ul><li>åŒ¹é…æ“ä½œï¼šre.match() å’Œ re.search()</li><li>æ£€ç´¢æ‰€æœ‰åŒ¹é…ç»“æœï¼šre.findall() å’Œ re.finditer()</li><li>å­—ç¬¦ä¸²åˆ†å‰²ï¼šre.split()</li><li>å­—ç¬¦ä¸²æ›¿æ¢ï¼šre.sub() å’Œ re.subn()</li><li>æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼šre.compile()</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒ¹é…æ“ä½œ matchæ˜¯ä»å¼€å¤´åŒ¹é…ï¼Œsearchæ˜¯ä»ä»»æ„ä½ç½®åŒ¹é…ï¼ˆä½¿ç”¨åœºæ™¯ä¸åŒï¼‰</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šäºŒè€…ä¸æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„è´ªå©ªåŒ¹é…æ²¡æœ‰ç›´æ¥å…³ç³» è´ªå©ªåŒ¹é…æ˜¯æŒ‡åœ¨åŒ¹é…æ—¶ä¼šå°½å¯èƒ½å¤šåœ°åŒ¹é…å­—ç¬¦</span></span><br><span class="line">result = re.<span class="keyword">match</span>(pattern, string)</span><br><span class="line">result = re.search(pattern, string)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡</span></span><br><span class="line">pattern_obj = re.<span class="built_in">compile</span>(pattern)</span><br><span class="line">result = pattern_obj.search(string)</span><br></pre></td></tr></table></figure><p>æ£€ç´¢æ‰€æœ‰åŒ¹é…ç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># findallåœ¨æŒ‡å®šå­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾åŒ¹é…æŸä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰å­ä¸²ï¼Œå¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›è¿™äº›å­ä¸²</span></span><br><span class="line"><span class="comment"># finditerè¿”å›ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰åŒ¹é…å¯¹è±¡çš„è¿­ä»£å™¨ </span></span><br><span class="line"><span class="comment"># å¯éå†è¿™ä¸ªè¿­ä»£å™¨è·å–æ¯ä¸ªåŒ¹é…å¯¹è±¡ï¼Œç„¶åç”¨groupè·å–åŒ¹é…å¯¹è±¡ä¸­çš„å…·ä½“å­ä¸²</span></span><br><span class="line">result = re.findall(pattern, string)</span><br><span class="line">result = re.finditer(pattern, string)</span><br></pre></td></tr></table></figure><p>åˆ†å‰²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­—ç¬¦ä¸²åˆ†å‰²</span></span><br><span class="line">result = re.split(pattern, string)</span><br></pre></td></tr></table></figure><p>æ›¿æ¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">subç”¨äºæ›¿æ¢å­—ç¬¦ä¸²ä¸­ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­ä¸²,å®ƒå¹¶ä¸ä¼šæ”¹å˜åŸå§‹å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªè¿›è¡Œæ›¿æ¢æ“ä½œä¹‹åçš„æ–°å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="string">åŸºæœ¬è¯­æ³•ä¸º re.sub(pattern, repl, string, count=0, flags=0)</span></span><br><span class="line"><span class="string">pattern: è¦åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ã€‚</span></span><br><span class="line"><span class="string">repl: è¦æ›¿æ¢åŒ¹é…çš„å­ä¸²çš„å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string">string: è¦è¿›è¡ŒåŒ¹é…å’Œæ›¿æ¢çš„åŸå§‹å­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="string">count: æœ€å¤šè¿›è¡Œå¤šå°‘å¤„æ›¿æ¢æ“ä½œï¼Œé»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºè¿›è¡Œæ‰€æœ‰åŒ¹é…çš„æ›¿æ¢ã€‚</span></span><br><span class="line"><span class="string">flags: å¯é€‰çš„æ ‡å¿—å‚æ•°ã€‚</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">result = re.sub(pattern, replace, string)</span><br><span class="line">result = re.subn(pattern, replace, string)</span><br><span class="line"></span><br><span class="line"><span class="comment"># demo</span></span><br><span class="line">string = <span class="string">&quot;Hello, world. How are you today?&quot;</span></span><br><span class="line">new_string = re.sub(<span class="string">r&#x27;\.&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, string)</span><br><span class="line"><span class="built_in">print</span>(new_string)</span><br><span class="line"><span class="comment"># è¾“å‡ºï¼š Hello, world! How are you today?</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESèšåˆæŸ¥è¯¢</title>
      <link href="/2021/12/06/ES%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2/"/>
      <url>/2021/12/06/ES%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2/</url>
      
        <content type="html"><![CDATA[<p>èšåˆæ¡†æ¶æœ‰åŠ©äºæ ¹æ®æœç´¢æŸ¥è¯¢æä¾›èšåˆæ•°æ®ã€‚èšåˆæŸ¥è¯¢æ˜¯æ•°æ®åº“ä¸­é‡è¦çš„åŠŸèƒ½ç‰¹æ€§ï¼ŒESä½œä¸ºæœç´¢å¼•æ“å…¼æ•°æ®åº“ï¼ŒåŒæ ·æä¾›äº†å¼ºå¤§çš„èšåˆåˆ†æèƒ½åŠ›ã€‚å®ƒåŸºäºæŸ¥è¯¢æ¡ä»¶æ¥å¯¹æ•°æ®è¿›è¡Œåˆ†æ¡¶ã€è®¡ç®—çš„æ–¹æ³•ã€‚æœ‰ç‚¹ç±»ä¼¼äº SQL ä¸­çš„ group by å†åŠ ä¸€äº›å‡½æ•°æ–¹æ³•çš„æ“ä½œã€‚èšåˆå¯ä»¥åµŒå¥—ï¼Œç”±æ­¤å¯ä»¥ç»„æˆå¤æ‚çš„æ“ä½œã€‚</p><p>èšåˆè®¡ç®—çš„å€¼å¯ä»¥å–<strong>å­—æ®µçš„å€¼</strong>ï¼Œä¹Ÿå¯æ˜¯<strong>è„šæœ¬è®¡ç®—çš„ç»“æœ</strong>ã€‚æŸ¥è¯¢è¯·æ±‚ä½“ä¸­ä»¥aggregationsèŠ‚ç‚¹çš„<strong>è¯­æ³•å®šä¹‰</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;aggregations&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>                        <span class="comment">//ä¹Ÿå¯ç®€å†™ä¸º aggs</span></span><br><span class="line">    <span class="attr">&quot;&lt;aggregation_name&gt;&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>      <span class="comment">//èšåˆçš„åå­—</span></span><br><span class="line">        <span class="attr">&quot;&lt;aggregation_type&gt;&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>     <span class="comment">//èšåˆçš„ç±»å‹</span></span><br><span class="line">            &lt;aggregation_body&gt;      <span class="comment">//èšåˆä½“ï¼šå¯¹å“ªäº›å­—æ®µè¿›è¡Œèšåˆ</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">[</span><span class="punctuation">,</span><span class="attr">&quot;meta&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>  <span class="punctuation">[</span>&lt;meta_data_body&gt;<span class="punctuation">]</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span>?                 <span class="comment">//å…ƒ</span></span><br><span class="line">        <span class="punctuation">[</span><span class="punctuation">,</span><span class="attr">&quot;aggregations&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="punctuation">[</span>&lt;sub_aggregation&gt;<span class="punctuation">]</span>+ <span class="punctuation">&#125;</span> <span class="punctuation">]</span>?   <span class="comment">//åœ¨èšåˆé‡Œé¢åœ¨å®šä¹‰å­èšåˆ</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">[</span><span class="punctuation">,</span><span class="attr">&quot;&lt;aggregation_name_2&gt;&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> ... <span class="punctuation">&#125;</span> <span class="punctuation">]</span>*                      <span class="comment">//èšåˆçš„åå­—</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="1-æŒ‡æ ‡èšåˆ"><a href="#1-æŒ‡æ ‡èšåˆ" class="headerlink" title="1. æŒ‡æ ‡èšåˆ"></a>1. æŒ‡æ ‡èšåˆ</h1><blockquote><p>å®ƒæ˜¯å¯¹æ–‡æ¡£è¿›è¡Œä¸€äº›æƒå€¼è®¡ç®—ï¼ˆæ¯”å¦‚æ±‚æ‰€æœ‰æ–‡æ¡£æŸä¸ªå­—æ®µæ±‚æœ€å¤§ã€æœ€å°ã€å’Œã€å¹³å‡å€¼ï¼‰ï¼Œè¾“å‡ºç»“æœå¾€å¾€æ˜¯æ–‡æ¡£çš„æƒå€¼ï¼Œç›¸å½“äºä¸ºæ–‡æ¡£æ·»åŠ äº†ä¸€äº›ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>å®ƒåŸºäºç‰¹å®šå­—æ®µï¼ˆfieldï¼‰æˆ–è„šæœ¬å€¼ï¼ˆgenerated using scriptsï¼‰ï¼Œè®¡ç®—èšåˆä¸­æ–‡æ¡£çš„æ•°å€¼æƒå€¼ã€‚æ•°å€¼æƒå€¼èšåˆï¼ˆæ³¨æ„åˆ†ç±»åªé’ˆå¯¹æ•°å€¼æƒå€¼èšåˆï¼Œéæ•°å€¼çš„æ— æ­¤åˆ†ç±»ï¼‰è¾“å‡ºå•ä¸ªæƒå€¼çš„ï¼Œä¹Ÿå« single-value numeric metricsï¼Œå…¶å®ƒç”Ÿæˆå¤šä¸ªæƒå€¼ï¼ˆæ¯”å¦‚ï¼šstatsï¼‰çš„è¢«å«åš multi-value numeric metricsã€‚</p></blockquote><h2 id="1-1-max-min-sum-avg"><a href="#1-1-max-min-sum-avg" class="headerlink" title="1.1 max min sum avg"></a>1.1 max min sum avg</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-max-aggregation.html">Max Aggregation</a>ï¼Œæ±‚æœ€å¤§å€¼ã€‚åŸºäºæ–‡æ¡£çš„æŸä¸ªå€¼ï¼ˆå¯ä»¥æ˜¯ç‰¹å®šçš„æ•°å€¼å‹å­—æ®µï¼Œä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬è®¡ç®—è€Œæ¥ï¼‰ï¼Œè®¡ç®—è¯¥å€¼åœ¨èšåˆæ–‡æ¡£ä¸­çš„å‡å€¼ã€‚</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /sales/_search?size=0</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;max_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;max&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;took&quot;</span><span class="punctuation">:</span> <span class="number">2080</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timed_out&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_shards&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;successful&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;skipped&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;failed&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;max_score&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;max_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">200.0</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-min-aggregation.html">Min Aggregation</a>ï¼Œæ±‚æœ€å°å€¼ã€‚åŒä¸Š</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /sales/_search?size=0</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;min&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;min&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-sum-aggregation.html">Sum Aggregation</a>ï¼Œæ±‚å’Œã€‚åŒä¸Š</p></blockquote><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /sales/_search?size=0</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;min_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;min&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;constant_score&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hat&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;hat_prices&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;sum&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;price&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-avg-aggregation.html">Avg Aggregation</a>ï¼Œæ±‚å¹³å‡æ•°ã€‚åŒä¸Š</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /exams/_search?size=<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;avg_grade&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;grade&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><h2 id="1-2-å€¼ç»Ÿè®¡"><a href="#1-2-å€¼ç»Ÿè®¡" class="headerlink" title="1.2 å€¼ç»Ÿè®¡"></a>1.2 å€¼ç»Ÿè®¡</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-valuecount-aggregation.html">Value Count Aggregation</a>ï¼Œå€¼è®¡æ•°èšåˆã€‚è®¡ç®—èšåˆæ–‡æ¡£ä¸­æŸä¸ªå€¼ï¼ˆå¯ä»¥æ˜¯ç‰¹å®šçš„æ•°å€¼å‹å­—æ®µï¼Œä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬è®¡ç®—è€Œæ¥ï¼‰çš„ä¸ªæ•°ã€‚è¯¥èšåˆä¸€èˆ¬åŸŸå…¶å®ƒ single-value <strong>èšåˆè”åˆä½¿ç”¨</strong>ï¼Œæ¯”å¦‚åœ¨è®¡ç®—ä¸€ä¸ªå­—æ®µçš„å¹³å‡å€¼çš„æ—¶å€™ï¼Œå¯èƒ½è¿˜ä¼šå…³æ³¨è¿™ä¸ªå¹³å‡å€¼æ˜¯ç”±å¤šå°‘ä¸ªå€¼è®¡ç®—è€Œæ¥ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/_search?size=<span class="number">0</span></span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;value_count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1000</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="1-3-distinct-èšåˆ"><a href="#1-3-distinct-èšåˆ" class="headerlink" title="1.3 distinct èšåˆ"></a>1.3 distinct èšåˆ</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-cardinality-aggregation.html">Cardinality Aggregation</a>ï¼ŒåŸºæ•°èšåˆã€‚å®ƒå±äºmulti-valueï¼ŒåŸºäºæ–‡æ¡£çš„æŸä¸ªå€¼ï¼ˆå¯ä»¥æ˜¯ç‰¹å®šçš„å­—æ®µï¼Œä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬è®¡ç®—è€Œæ¥ï¼‰ï¼Œè®¡ç®—æ–‡æ¡£éé‡å¤çš„ä¸ªæ•°ï¼ˆå»é‡è®¡æ•°ï¼‰ï¼Œç›¸å½“äºsqlä¸­çš„distinctã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/_search?size=<span class="number">0</span></span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;cardinality&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;state_count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;cardinality&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;state.keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;state_count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">51</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age_count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">21</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="1-3-ç»Ÿè®¡èšåˆ"><a href="#1-3-ç»Ÿè®¡èšåˆ" class="headerlink" title="1.3 ç»Ÿè®¡èšåˆ"></a>1.3 ç»Ÿè®¡èšåˆ</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-stats-aggregation.html">Stats Aggregation</a>ï¼Œç»Ÿè®¡èšåˆã€‚å®ƒå±äºmulti-valueï¼ŒåŸºäºæ–‡æ¡£çš„æŸä¸ªå€¼ï¼ˆå¯ä»¥æ˜¯ç‰¹å®šçš„æ•°å€¼å‹å­—æ®µï¼Œä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬è®¡ç®—è€Œæ¥ï¼‰ï¼Œè®¡ç®—å‡ºä¸€äº›ç»Ÿè®¡ä¿¡æ¯ï¼ˆminã€maxã€sumã€countã€avg5ä¸ªå€¼ï¼‰ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/_search?size=<span class="number">0</span></span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_stats&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;stats&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_stats&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;min&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;max&quot;</span><span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="number">30.171</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sum&quot;</span><span class="punctuation">:</span> <span class="number">30171</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="1-4-ç™¾åˆ†æ¯”æŸ¥è¯¢"><a href="#1-4-ç™¾åˆ†æ¯”æŸ¥è¯¢" class="headerlink" title="1.4 ç™¾åˆ†æ¯”æŸ¥è¯¢"></a>1.4 ç™¾åˆ†æ¯”æŸ¥è¯¢</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-percentile-aggregation.html">tiles Aggregation</a>ï¼Œç™¾åˆ†æ¯”èšåˆã€‚å®ƒå±äºmulti-valueï¼Œå¯¹æŒ‡å®šå­—æ®µï¼ˆè„šæœ¬ï¼‰çš„å€¼æŒ‰ä»å°åˆ°å¤§ç´¯è®¡æ¯ä¸ªå€¼å¯¹åº”çš„æ–‡æ¡£æ•°çš„å æ¯”ï¼ˆå æ‰€æœ‰å‘½ä¸­æ–‡æ¡£æ•°çš„ç™¾åˆ†æ¯”ï¼‰ï¼Œè¿”å›æŒ‡å®šå æ¯”æ¯”ä¾‹å¯¹åº”çš„å€¼ã€‚é»˜è®¤è¿”å›[ 1, 5, 25, 50, 75, 95, 99 ]åˆ†ä½ä¸Šçš„å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/_search?size=0</span><br><span class="line">&#123;undefined</span><br><span class="line">  &quot;aggs&quot;: &#123;undefined</span><br><span class="line">    &quot;age_percents&quot;: &#123;undefined</span><br><span class="line">      &quot;percentiles&quot;: &#123;undefined</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;//è¿”å›</span><br><span class="line">    ...</span><br><span class="line">  &quot;aggregations&quot;: &#123;undefined</span><br><span class="line">    &quot;age_percents&quot;: &#123;undefined</span><br><span class="line">      &quot;values&quot;: &#123;undefined</span><br><span class="line">        &quot;1.0&quot;: 20,</span><br><span class="line">        &quot;5.0&quot;: 21,</span><br><span class="line">        &quot;25.0&quot;: 25,</span><br><span class="line">        &quot;50.0&quot;: 31,   //å æ¯”ä¸º50%çš„æ–‡æ¡£çš„ageå€¼ &lt;= 31ï¼Œæˆ–åè¿‡æ¥ï¼šage&lt;=31çš„æ–‡æ¡£æ•°å æ€»å‘½ä¸­æ–‡æ¡£æ•°çš„50%</span><br><span class="line">        &quot;75.0&quot;: 35.00000000000001,</span><br><span class="line">        &quot;95.0&quot;: 39,</span><br><span class="line">        &quot;99.0&quot;: 40</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><h2 id="1-5-Top-Hits"><a href="#1-5-Top-Hits" class="headerlink" title="1.5 Top Hits"></a>1.5 Top Hits</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-metrics-top-hits-aggregation.html">Top Hits Aggregation</a>ï¼Œæœ€é«˜åŒ¹é…æƒå€¼èšåˆã€‚è·å–åˆ°æ¯ç»„å‰næ¡æ•°æ®ï¼Œç›¸å½“äºsql ä¸­Topï¼ˆgroup by åå–å‡ºå‰næ¡ï¼‰ã€‚å®ƒè·Ÿè¸ªèšåˆä¸­ç›¸å…³æ€§æœ€é«˜çš„æ–‡æ¡£ï¼Œè¯¥èšåˆä¸€èˆ¬ç”¨åš sub-aggregationï¼Œä»¥æ­¤æ¥èšåˆæ¯ä¸ªæ¡¶ä¸­çš„æœ€é«˜åŒ¹é…çš„æ–‡æ¡£ï¼Œè¾ƒä¸ºå¸¸ç”¨çš„ç»Ÿè®¡ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ggregationï¼Œä»¥æ­¤æ¥èšåˆæ¯ä¸ªæ¡¶ä¸­çš„æœ€é«˜åŒ¹é…çš„æ–‡æ¡£ï¼Œè¾ƒä¸ºå¸¸ç”¨çš„ç»Ÿè®¡ã€‚</span><br><span class="line"></span><br><span class="line">GET index/type/_search?search_type=count</span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;all_interests&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zxw_id&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;top_tag_hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;top_hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">1</span>    <span class="comment">//è¿”å›çš„æœ€å¤§æ–‡æ¡£ä¸ªæ•°ï¼ˆdefault 3ï¼‰</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><hr><h1 id="2-æ¡¶èšåˆ"><a href="#2-æ¡¶èšåˆ" class="headerlink" title="2. æ¡¶èšåˆ"></a>2. æ¡¶èšåˆ</h1><blockquote><p>Bucket Aggregationsï¼Œæ¡¶èšåˆã€‚</p><p>å®ƒæ‰§è¡Œçš„æ˜¯å¯¹æ–‡æ¡£åˆ†ç»„çš„æ“ä½œï¼ˆä¸sqlä¸­çš„group byç±»ä¼¼ï¼‰ï¼ŒæŠŠæ»¡è¶³ç›¸å…³ç‰¹æ€§çš„æ–‡æ¡£åˆ†åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œå³æ¡¶åˆ†ï¼Œè¾“å‡ºç»“æœå¾€å¾€æ˜¯ä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ–‡æ¡£çš„æ¡¶ï¼ˆä¸€ä¸ªæ¡¶å°±æ˜¯ä¸€ä¸ªgroupï¼‰ã€‚</p><p>å®ƒæœ‰ä¸€ä¸ªå…³é”®å­—ï¼ˆfieldã€scriptï¼‰ï¼Œä»¥åŠä¸€äº›æ¡¶åˆ†ï¼ˆåˆ†ç»„ï¼‰çš„åˆ¤æ–­æ¡ä»¶ã€‚æ‰§è¡Œèšåˆæ“ä½œæ—¶å€™ï¼Œæ–‡æ¡£ä¼šåˆ¤æ–­æ¯ä¸€ä¸ªåˆ†ç»„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŸä¸ªï¼Œè¯¥æ–‡æ¡£å°±ä¼šè¢«åˆ†ä¸ºè¯¥ç»„ï¼ˆfall inï¼‰ã€‚</p><p>å®ƒä¸è¿›è¡Œæƒå€¼çš„è®¡ç®—ï¼Œä»–ä»¬å¯¹æ–‡æ¡£æ ¹æ®èšåˆè¯·æ±‚ä¸­æä¾›çš„åˆ¤æ–­æ¡ä»¶ï¼ˆæ¯”å¦‚ï¼š{â€œfromâ€:0,  â€œtoâ€:100}ï¼‰æ¥è¿›è¡Œåˆ†ç»„ï¼ˆæ¡¶åˆ†ï¼‰ã€‚æ¡¶èšåˆè¿˜ä¼šé¢å¤–è¿”å›æ¯ä¸€ä¸ªæ¡¶å†…æ–‡æ¡£çš„ä¸ªæ•°ã€‚</p><p>å®ƒå¯ä»¥åŒ…å«å­èšåˆâ€”â€”sub-aggregationsï¼ˆæƒå€¼èšåˆä¸èƒ½åŒ…å«å­èšåˆï¼Œå¯ä»¥ä½œä¸ºå­èšåˆï¼‰ï¼Œå­èšåˆæ“ä½œå°†ä¼šåº”ç”¨åˆ°ç”±çˆ¶èšåˆäº§ç”Ÿçš„æ¯ä¸€ä¸ªæ¡¶ä¸Šã€‚</p><p>å®ƒæ ¹æ®èšåˆæ¡ä»¶ï¼Œå¯ä»¥åªå®šä¹‰è¾“å‡ºä¸€ä¸ªæ¡¶ï¼›ä¹Ÿå¯ä»¥è¾“å‡ºå¤šä¸ªï¼ˆmulti-bucketï¼‰ï¼›è¿˜å¯ä»¥åœ¨æ ¹æ®èšåˆæ¡ä»¶åŠ¨æ€ç¡®å®šæ¡¶ä¸ªæ•°ï¼ˆæ¯”å¦‚ï¼šterms aggregationï¼‰ã€‚</p></blockquote><h2 id="2-1-Terms-Aggregation"><a href="#2-1-Terms-Aggregation" class="headerlink" title="2.1 Terms Aggregation"></a>2.1 Terms Aggregation</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-terms-aggregation.html">Terms Aggregation</a>ï¼Œè¯èšåˆã€‚åŸºäºæŸä¸ªfieldï¼Œè¯¥ field å†…çš„æ¯ä¸€ä¸ªã€å”¯ä¸€è¯å…ƒã€‘ä¸ºä¸€ä¸ªæ¡¶ï¼Œå¹¶è®¡ç®—æ¯ä¸ªæ¡¶å†…æ–‡æ¡£ä¸ªæ•°ã€‚é»˜è®¤è¿”å›é¡ºåºæ˜¯æŒ‰ç…§æ–‡æ¡£ä¸ªæ•°å¤šå°‘æ’åºã€‚å®ƒå±äºmulti-bucketã€‚å½“ä¸è¿”å›æ‰€æœ‰ buckets çš„æƒ…å†µï¼ˆå®ƒsizeæ§åˆ¶ï¼‰ï¼Œæ–‡æ¡£ä¸ªæ•°å¯èƒ½ä¸å‡†ç¡®ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/_search?size=<span class="number">0</span></span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;age_terms&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;terms&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">              <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;age&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;size&quot;</span> <span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span>                              <span class="comment">//sizeç”¨æ¥å®šä¹‰éœ€è¦è¿”å›å¤šä¸ª bucketsï¼ˆé˜²æ­¢å¤ªå¤šï¼‰ï¼Œé»˜è®¤ä¼šå…¨éƒ¨è¿”å›ã€‚</span></span><br><span class="line">              <span class="attr">&quot;order&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;_count&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span>  <span class="comment">//æ ¹æ®æ–‡æ¡£è®¡æ•°æ’åºï¼Œæ ¹æ®åˆ†ç»„å€¼æ’åºï¼ˆ&#123; &quot;_key&quot; : &quot;asc&quot; &#125;ï¼‰</span></span><br><span class="line">              <span class="attr">&quot;min_doc_count&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span>            <span class="comment">//åªè¿”å›æ–‡æ¡£ä¸ªæ•°ä¸å°äºè¯¥å€¼çš„ buckets</span></span><br><span class="line">              <span class="attr">&quot;include&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;.*sport.*&quot;</span><span class="punctuation">,</span>            <span class="comment">//åŒ…å«è¿‡æ»¤</span></span><br><span class="line">              <span class="attr">&quot;exclude&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;water_.*&quot;</span><span class="punctuation">,</span>          <span class="comment">//æ’é™¤è¿‡æ»¤</span></span><br><span class="line">              <span class="attr">&quot;missing&quot;</span><span class="punctuation">:</span> <span class="string">&quot;N/A&quot;</span> </span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/_search?size=<span class="number">0</span></span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;shard_size&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span> <span class="comment">//æŒ‡å®šæ¯ä¸ªåˆ†ç‰‡è¿”å›å¤šå°‘ä¸ªåˆ†ç»„ï¼Œé»˜è®¤å€¼ï¼ˆç´¢å¼•åªæœ‰ä¸€ä¸ªåˆ†ç‰‡ï¼š= sizeï¼Œå¤šåˆ†ç‰‡ï¼š= size * 1.5 + 10ï¼‰</span></span><br><span class="line">        <span class="attr">&quot;show_term_doc_count_error&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span>      <span class="comment">//æ¯ä¸ªåˆ†ç»„ä¸Šæ˜¾ç¤ºåå·®å€¼</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">    <span class="attr">&quot;age_terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">      <span class="attr">&quot;doc_count_error_upper_bound&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="comment">//æ–‡æ¡£è®¡æ•°çš„æœ€å¤§åå·®å€¼</span></span><br><span class="line">      <span class="attr">&quot;sum_other_doc_count&quot;</span><span class="punctuation">:</span> <span class="number">463</span><span class="punctuation">,</span>           <span class="comment">//æœªè¿”å›çš„å…¶ä»–é¡¹çš„æ–‡æ¡£æ•°</span></span><br><span class="line">      <span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>                <span class="comment">//é»˜è®¤æƒ…å†µä¸‹è¿”å›æŒ‰æ–‡æ¡£è®¡æ•°ä»é«˜åˆ°ä½çš„å‰10ä¸ªåˆ†ç»„</span></span><br><span class="line">        <span class="punctuation">&#123;</span> </span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="number">31</span><span class="punctuation">,</span>              <span class="comment">//å¹´é¾„ä¸º31çš„æ–‡æ¡£æœ‰61ä¸ª</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">61</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> </span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="number">39</span><span class="punctuation">,</span>            <span class="comment">//å¹´é¾„ä¸º39çš„æ–‡æ¡£æœ‰60ä¸ª</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">60</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span> </span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="number">34</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">49</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="2-2-filter-Aggregation"><a href="#2-2-filter-Aggregation" class="headerlink" title="2.2 filter Aggregation"></a>2.2 filter Aggregation</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-filter-aggregation.html">Filter Aggregation</a>ï¼Œè¿‡æ»¤èšåˆã€‚åŸºäºä¸€ä¸ªæ¡ä»¶ï¼Œæ¥å¯¹å½“å‰çš„æ–‡æ¡£è¿›è¡Œè¿‡æ»¤çš„èšåˆã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/_search?size=<span class="number">0</span></span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span><span class="string">&quot;F&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;avg_age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">493</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;avg_age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">30.3184584178499</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="2-3-Filters-Aggregation"><a href="#2-3-Filters-Aggregation" class="headerlink" title="2.3 Filters Aggregation"></a>2.3 Filters Aggregation</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-filters-aggregation.html">Filters Aggregation</a>ï¼Œå¤šè¿‡æ»¤èšåˆã€‚åŸºäºå¤šä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œæ¥å¯¹å½“å‰æ–‡æ¡£è¿›è¡Œã€è¿‡æ»¤ã€‘çš„èšåˆï¼Œæ¯ä¸ªè¿‡æ»¤éƒ½åŒ…å«æ‰€æœ‰æ»¡è¶³å®ƒçš„æ–‡æ¡£ï¼ˆå¤šä¸ªbucketä¸­å¯èƒ½é‡å¤ï¼‰ï¼Œå…ˆè¿‡æ»¤å†èšåˆã€‚å®ƒå±äºmulti-bucketã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">GET logs/_search</span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;messages&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// é…ç½®è¿‡æ»¤æ¡ä»¶ï¼Œæ”¯æŒ HASH æˆ– æ•°ç»„æ ¼å¼</span></span><br><span class="line">        <span class="attr">&quot;filters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">              <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="string">&quot;error&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;warnings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">              <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warning&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;messages&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;warnings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="2-4-èŒƒå›´èšåˆ"><a href="#2-4-èŒƒå›´èšåˆ" class="headerlink" title="2.4 èŒƒå›´èšåˆ"></a>2.4 èŒƒå›´èšåˆ</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-range-aggregation.html">Range Aggregation</a>ï¼ŒèŒƒå›´åˆ†ç»„èšåˆã€‚åŸºäºæŸä¸ªå€¼ï¼ˆå¯ä»¥æ˜¯ field æˆ– scriptï¼‰ï¼Œä»¥ã€å­—æ®µèŒƒå›´ã€‘æ¥æ¡¶åˆ†èšåˆã€‚èŒƒå›´èšåˆåŒ…æ‹¬ from å€¼ï¼Œä¸åŒ…æ‹¬ to å€¼ï¼ˆåŒºé—´å‰é—­åå¼€ï¼‰ã€‚å®ƒå±äºmulti-bucketã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">tionï¼ŒèŒƒå›´åˆ†ç»„èšåˆã€‚åŸºäºæŸä¸ªå€¼ï¼ˆå¯ä»¥æ˜¯ field æˆ– scriptï¼‰ï¼Œä»¥ã€å­—æ®µèŒƒå›´ã€‘æ¥æ¡¶åˆ†èšåˆã€‚èŒƒå›´èšåˆåŒ…æ‹¬ from å€¼ï¼Œä¸åŒ…æ‹¬ to å€¼ï¼ˆåŒºé—´å‰é—­åå¼€ï¼‰ã€‚å®ƒå±äºmulti-bucketã€‚</span><br><span class="line"></span><br><span class="line">POST /bank/_search?size=<span class="number">0</span></span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">//é…ç½®åŒºé—´</span></span><br><span class="line">          <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="number">25</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="number">35</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">35</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;bmax&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;max&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;balance&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;age_range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*-25.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">225</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;bmax&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">49587</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;25.0-35.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="number">35</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">485</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;bmax&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">49795</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;35.0-*&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">35</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">290</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;bmax&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">49989</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="2-5-æ—¶é—´èŒƒå›´èšåˆ"><a href="#2-5-æ—¶é—´èŒƒå›´èšåˆ" class="headerlink" title="2.5 æ—¶é—´èŒƒå›´èšåˆ"></a>2.5 æ—¶é—´èŒƒå›´èšåˆ</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-daterange-aggregation.html">Date Range Aggregation</a>ï¼Œæ—¥æœŸèŒƒå›´èšåˆã€‚åŸºäºæ—¥æœŸç±»å‹çš„å€¼ï¼Œä»¥ã€æ—¥æœŸèŒƒå›´ã€‘æ¥æ¡¶åˆ†èšåˆã€‚æœŸèŒƒå›´å¯ä»¥ç”¨å„ç§ <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/common-options.html#date-math">Date Math</a> è¡¨è¾¾å¼ã€‚åŒæ ·çš„ï¼ŒåŒ…æ‹¬ from çš„å€¼ï¼Œä¸åŒ…æ‹¬ to çš„å€¼ã€‚å®ƒå±äºmulti-bucketã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">POST /bank/_search?size=<span class="number">0</span></span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;date_range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MM-yyy&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>   <span class="comment">//åŒ…å«2ä¸ªæ¡¶</span></span><br><span class="line">          <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;now-10M/M&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;now-10M/M&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">      <span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*-2017-08-01T00:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="number">1501545600000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;to_as_string&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2017-08-01T00:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span>undefined</span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2017-08-01T00:00:00.000Z-*&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">1501545600000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;from_as_string&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2017-08-01T00:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="2-6-IPèŒƒå›´èšåˆ"><a href="#2-6-IPèŒƒå›´èšåˆ" class="headerlink" title="2.6 IPèŒƒå›´èšåˆ"></a>2.6 IPèŒƒå›´èšåˆ</h2><blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-aggregations-bucket-iprange-aggregation.html">IP Range Aggregation</a>ï¼ŒåŸºäºä¸€ä¸ª IPv4 å­—æ®µï¼Œå¯¹æ–‡æ¡£è¿›è¡Œã€IPv4èŒƒå›´ã€‘çš„æ¡¶åˆ†èšåˆã€‚å’Œ Range Aggregation ç±»ä¼¼ï¼Œåªæ˜¯åº”ç”¨å­—æ®µå¿…é¡»æ˜¯ IPv4 æ•°æ®ç±»å‹ã€‚å®ƒå±äºmulti-bucketã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">GET /ip_addresses/_search</span><br><span class="line"><span class="punctuation">&#123;</span>undefined</span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;ip_ranges&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;ip_range&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">                <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ip&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;ranges&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span> <span class="attr">&quot;to&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10.0.0.5&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span> <span class="attr">&quot;from&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10.0.0.5&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="comment">//è¿”å›</span></span><br><span class="line">    <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">        <span class="attr">&quot;ip_ranges&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>undefined</span><br><span class="line">            <span class="attr">&quot;buckets&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span>undefined</span><br><span class="line">                    <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.0.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span>undefined</span><br><span class="line">                    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.0.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">260</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³macè§¦æ§æ‰‹åŠ¿æˆ–å¿«æ·é”®å¤±æ•ˆ</title>
      <link href="/2021/11/17/%E8%A7%A3%E5%86%B3mac%E8%A7%A6%E6%8E%A7%E6%89%8B%E5%8A%BF%E6%88%96%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%A4%B1%E6%95%88/"/>
      <url>/2021/11/17/%E8%A7%A3%E5%86%B3mac%E8%A7%A6%E6%8E%A7%E6%89%8B%E5%8A%BF%E6%88%96%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%A4%B1%E6%95%88/</url>
      
        <content type="html"><![CDATA[<h3 id="è§¦æ§æ¿æ‰‹åŠ¿å¤±æ•ˆ"><a href="#è§¦æ§æ¿æ‰‹åŠ¿å¤±æ•ˆ" class="headerlink" title="è§¦æ§æ¿æ‰‹åŠ¿å¤±æ•ˆ"></a>è§¦æ§æ¿æ‰‹åŠ¿å¤±æ•ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall Dock</span><br></pre></td></tr></table></figure><h3 id="å¤åˆ¶ç²˜è´´å¿«æ·é”®å¤±æ•ˆ"><a href="#å¤åˆ¶ç²˜è´´å¿«æ·é”®å¤±æ•ˆ" class="headerlink" title="å¤åˆ¶ç²˜è´´å¿«æ·é”®å¤±æ•ˆ"></a>å¤åˆ¶ç²˜è´´å¿«æ·é”®å¤±æ•ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall pboard</span><br></pre></td></tr></table></figure><h3 id="touchbarå¤±æ•ˆ"><a href="#touchbarå¤±æ•ˆ" class="headerlink" title="touchbarå¤±æ•ˆ"></a>touchbarå¤±æ•ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pkill TouchBarServer</span><br></pre></td></tr></table></figure><h3 id="å·¦é”®å•å‡»å¤±æ•ˆ"><a href="#å·¦é”®å•å‡»å¤±æ•ˆ" class="headerlink" title="å·¦é”®å•å‡»å¤±æ•ˆ"></a>å·¦é”®å•å‡»å¤±æ•ˆ</h3><p>æ£€æŸ¥å¤–ç½®è®¾å¤‡æ¥å…¥ï¼Œé‡æ–°æ’æ‹”å³å¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonçš„è§£æ„èµ‹å€¼</title>
      <link href="/2021/08/02/python%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC/"/>
      <url>/2021/08/02/python%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<p>è§£æ„æ˜¯æŒ‡å°†å®¹å™¨ï¼ˆæ¯”å¦‚åˆ—è¡¨ã€å…ƒç»„ã€é›†åˆã€å­—å…¸ç­‰ï¼‰ä¸­çš„å…ƒç´ åˆ†åˆ«èµ‹å€¼ç»™å˜é‡ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p><p>è§£æ„å…ƒç»„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tpl = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">a, b, c = tpl</span><br><span class="line"><span class="built_in">print</span>(a, b, c)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 1 2 3 </span><br></pre></td></tr></table></figure><p>è§£æ„åˆ—è¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">a, b, c = lst</span><br><span class="line"><span class="built_in">print</span>(a, b, c)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 1 2 3 </span><br></pre></td></tr></table></figure><p>è§£æ„é›†åˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">st = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">a, b, c = st</span><br><span class="line"><span class="built_in">print</span>(a, b, c)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 1 2 3</span><br></pre></td></tr></table></figure><p>è§£æ„å­—å…¸</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line">a, b, c = d.values()</span><br><span class="line"><span class="built_in">print</span>(a, b, c)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 1 2 3</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ * å·ä»¥è§£æ„å‡ºå‰©ä½™çš„å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">a, b, *c = lst</span><br><span class="line"><span class="built_in">print</span>(a, b, c)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; (1, 2, [3, 4, 5])</span><br></pre></td></tr></table></figure><p>è§£æ„ä¹Ÿå¯ä»¥åœ¨å‡½æ•°è°ƒç”¨æ—¶ç”¨äºä¼ é€’å…ƒç»„æˆ–å­—å…¸çš„å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    <span class="built_in">print</span>(a, b, c)</span><br><span class="line"></span><br><span class="line">tpl = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">*tpl</span>)</span><br><span class="line">    </span><br><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">**d</span>)  <span class="comment"># ç­‰åŒäº print(a=1, b=2, c=3)</span></span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 1 2 3</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python2/3ä¸­base64çš„ä½¿ç”¨å·®å¼‚</title>
      <link href="/2021/07/10/python2:3%E4%B8%ADbase64%E7%9A%84%E4%BD%BF%E7%94%A8%E5%B7%AE%E5%BC%82/"/>
      <url>/2021/07/10/python2:3%E4%B8%ADbase64%E7%9A%84%E4%BD%BF%E7%94%A8%E5%B7%AE%E5%BC%82/</url>
      
        <content type="html"><![CDATA[<h2 id="python2"><a href="#python2" class="headerlink" title="python2"></a>python2</h2><p>åœ¨python2ä¸­ï¼Œbase64å¯ä»¥ç›´æ¥æ“ä½œstringç±»å‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">msg = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">encoded = base64.b64encode(msg)</span><br><span class="line">decoded = base64.b64decode(encoded)</span><br><span class="line"><span class="built_in">print</span>(encoded, decoded)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; (&#x27;aGVsbG8gd29ybGQ=&#x27;, &#x27;Hello World&#x27;)</span><br></pre></td></tr></table></figure><h2 id="python3"><a href="#python3" class="headerlink" title="python3"></a>python3</h2><p>åœ¨python3ä¸­ï¼Œbase64åªèƒ½æ“ä½œbytesç±»å‹ï¼Œç›´æ¥ç¼–ç ä¼šæŠ¥é”™ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: a bytes-like object is required, not &#x27;str&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">msg = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">encoded = base64.b64encode(msg.encode(<span class="string">&quot;utf-8&quot;</span>)).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">decoded = base64.b64decode(encoded).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(encoded, decoded)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; (&#x27;aGVsbG8gd29ybGQ=&#x27;, &#x27;hello world&#x27;)</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Python 2ï¼šå­—ç¬¦ä¸²é»˜è®¤æ˜¯å­—èŠ‚ä¸²ï¼ŒUnicodeå­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨uå‰ç¼€å£°æ˜ã€‚</p><p>Python 3ï¼šå­—ç¬¦ä¸²é»˜è®¤æ˜¯Unicodeå­—ç¬¦ä¸²ï¼Œå­—èŠ‚ä¸²éœ€è¦ä½¿ç”¨bå‰ç¼€å£°æ˜ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºJSON</title>
      <link href="/2021/06/28/%E5%85%B3%E4%BA%8EJSON/"/>
      <url>/2021/06/28/%E5%85%B3%E4%BA%8EJSON/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€å•¥æ˜¯-JSON"><a href="#ä¸€ã€å•¥æ˜¯-JSON" class="headerlink" title="ä¸€ã€å•¥æ˜¯ JSON ?"></a>ä¸€ã€å•¥æ˜¯ JSON ?</h2><p><code>JSONï¼ˆJavaScript Object Notationï¼‰</code>æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œé€šè¿‡ç®€æ´ã€é€šç”¨çš„è¯­æ³•è§„åˆ™æ¥è¡¨è¾¾æ•°æ®ã€‚å®ƒåŸºäº JavaScript è¯­è¨€çš„å­é›†ï¼Œä½†å·²æˆä¸ºä¸€ç§ç‹¬ç«‹äºç¼–ç¨‹è¯­è¨€çš„é€šç”¨æ•°æ®æ ¼å¼ã€‚JSON æ ¼å¼æ˜“äºé˜…è¯»å’Œç¼–å†™ï¼ŒåŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆï¼Œå› æ­¤åœ¨ç½‘ç»œä¼ è¾“å’Œæ•°æ®å­˜å‚¨ä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚</p><h3 id="JSON-çš„ä¸¤ç§åŸºæœ¬ç»“æ„ï¼š"><a href="#JSON-çš„ä¸¤ç§åŸºæœ¬ç»“æ„ï¼š" class="headerlink" title="JSON çš„ä¸¤ç§åŸºæœ¬ç»“æ„ï¼š"></a>JSON çš„ä¸¤ç§åŸºæœ¬ç»“æ„ï¼š</h3><ol><li>å¯¹è±¡ï¼ˆObjectï¼‰ï¼šå¯¹è±¡æ˜¯ä¸€ä¸ªæ— åºçš„é”®å€¼å¯¹é›†åˆï¼Œé”®å€¼å¯¹ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ï¼Œæ•´ä¸ªå¯¹è±¡åŒ…å«åœ¨èŠ±æ‹¬å· <code>&#123;&#125;</code> ä¸­ã€‚é”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„ JSON æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€æ•°ç»„ã€å¯¹è±¡ã€nullï¼‰ã€‚</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç†Šç»´å°¼&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1953&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>æ•°ç»„ï¼ˆArrayï¼‰ï¼šæ•°ç»„æ˜¯ä¸€ä¸ªæœ‰åºçš„å€¼é›†åˆï¼Œå€¼ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ï¼Œæ•´ä¸ªæ•°ç»„åŒ…å«åœ¨æ–¹æ‹¬å· <code>[]</code> ä¸­ã€‚æ•°ç»„ä¸­çš„å€¼å¯ä»¥æ˜¯ä»»æ„åˆæ³•çš„ JSON æ•°æ®ç±»å‹ã€‚</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;apple&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;banana&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;orange&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>JSONæ ¼å¼çš„æ•°æ®å¯ä»¥è¢«å‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€è§£æå’Œç”Ÿæˆï¼Œå› ä¸ºå®ƒå…·æœ‰ç®€æ´ã€é€šç”¨å’Œæ˜“äºç†è§£çš„ç‰¹ç‚¹ã€‚åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼ŒJSONæ ¼å¼å¸¸ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼›åœ¨æ•°æ®å­˜å‚¨ä¸­ï¼ŒJSONæ ¼å¼ä¹Ÿç»å¸¸ç”¨äºä¿å­˜é…ç½®æ–‡ä»¶ã€æ—¥å¿—æ•°æ®ç­‰ã€‚JSON æ˜¯ä¸€ç§è·¨å¹³å°ã€é€šç”¨çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚</p><h2 id="äºŒã€pythonæ ‡å‡†åº“ä¸­çš„JSON"><a href="#äºŒã€pythonæ ‡å‡†åº“ä¸­çš„JSON" class="headerlink" title="äºŒã€pythonæ ‡å‡†åº“ä¸­çš„JSON"></a>äºŒã€pythonæ ‡å‡†åº“ä¸­çš„JSON</h2><p>Python çš„æ ‡å‡†åº“ä¸­æä¾›äº† JSON æ¨¡å—ï¼Œç”¨äºè§£æ JSON æ ¼å¼çš„æ•°æ®æˆ–å°† Python å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ ¼å¼ã€‚</p><h3 id="å°†JSONæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºpythonå¯¹è±¡"><a href="#å°†JSONæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºpythonå¯¹è±¡" class="headerlink" title="å°†JSONæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºpythonå¯¹è±¡"></a>å°†JSONæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºpythonå¯¹è±¡</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line"></span><br><span class="line">json_str = &#x27;<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç†Šç»´å°¼&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">70</span><span class="punctuation">,</span> <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Beijing&quot;</span><span class="punctuation">&#125;</span>&#x27;</span><br><span class="line">data = json.loads(json_str)</span><br><span class="line">print(data) </span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#123;&#x27;name&#x27;: &#x27;å°ç†Šç»´å°¼&#x27;, &#x27;age&#x27;: 70, &#x27;city&#x27;: &#x27;Beijing&#x27;&#125;</span><br></pre></td></tr></table></figure><h2 id="å°†pythonå¯¹è±¡è½¬æ¢ä¸º-JSON-å­—ç¬¦ä¸²"><a href="#å°†pythonå¯¹è±¡è½¬æ¢ä¸º-JSON-å­—ç¬¦ä¸²" class="headerlink" title="å°†pythonå¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²"></a>å°†pythonå¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²</h2><p>ä½¿ç”¨ <code>json.dumps()</code> å‡½æ•°å¯ä»¥å°† Python å¯¹è±¡è½¬æ¢ä¸º JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;å°ç†Šç»´å°¼&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">70</span>, <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;Beijing&#x27;</span>&#125;</span><br><span class="line">json_str = json.dumps(data, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(json_str)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30, &quot;city&quot;: &quot;New York&quot;&#125;</span><br></pre></td></tr></table></figure><p>å¯é€‰å‚æ•°ï¼ˆå‰ä¸‰ä¸ªæœ€å¸¸ç”¨ï¼‰</p><ol><li><code>default</code>ï¼šä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè‡ªå®šä¹‰å¯¹è±¡çš„åºåˆ—åŒ–æ–¹å¼ã€‚å¦‚æœå¯¹è±¡æ— æ³•è¢«åºåˆ—åŒ–ï¼Œåˆ™ä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼Œè¿”å›å¯¹è±¡çš„å¯åºåˆ—åŒ–è¡¨ç¤ºã€‚</li><li><code>indent</code>ï¼šä¸€ä¸ªæ•´æ•°æˆ–å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šè¾“å‡ºä¸­çš„ç¼©è¿›é‡ã€‚å¦‚æœæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œåˆ™è¡¨ç¤ºæ¯çº§ç¼©è¿›çš„ç©ºæ ¼æ•°ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™è¡¨ç¤ºç”¨äºç¼©è¿›çš„å­—ç¬¦ä¸²ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ã€‚</li><li><code>ensure_ascii</code>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º Trueã€‚å¦‚æœè®¾ç½®ä¸º Trueï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™æ‰€æœ‰é ASCII å­—ç¬¦å°†è½¬ä¹‰ï¼›å¦‚æœè®¾ç½®ä¸º Falseï¼Œåˆ™ä¸ä¼šè½¬ä¹‰é ASCII å­—ç¬¦ï¼Œå¯ç”¨äºå¤„ç†åŒ…å«é ASCII å­—ç¬¦çš„æ•°æ®ã€‚</li><li><code>cls</code>ï¼šä¸€ä¸ª JSONEncoder å­ç±»ï¼Œç”¨äºè‡ªå®šä¹‰ JSON åºåˆ—åŒ–å™¨ã€‚</li><li><code>skipkeys</code>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º Falseã€‚å¦‚æœè®¾ç½®ä¸º Trueï¼Œåˆ™ä¼šè·³è¿‡å­—å…¸ä¸­ä¸æ˜¯å­—ç¬¦ä¸²çš„é”®ï¼›å¦‚æœè®¾ç½®ä¸º Falseï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™ä¼šå¼•å‘ TypeErrorã€‚</li><li><code>separators</code>ï¼šä¸€ä¸ªå…ƒç»„ï¼Œé»˜è®¤ä¸º (â€˜, â€˜, â€˜: â€˜)ã€‚å¯ä»¥æŒ‡å®šç”¨äºåˆ†éš”å…ƒç´ çš„å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ç”¨äºåˆ†éš”å¯¹è±¡çš„é”®å€¼å¯¹ï¼Œç¬¬äºŒä¸ªå…ƒç´ ç”¨äºåˆ†éš”æ•°ç»„çš„å…ƒç´ ã€‚</li><li><code>sort_keys</code>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º Falseã€‚å¦‚æœè®¾ç½®ä¸º Trueï¼Œåˆ™ä¼šæŒ‰ç…§é”®çš„é¡ºåºå¯¹å­—å…¸è¿›è¡Œæ’åºï¼›å¦‚æœè®¾ç½®ä¸º Falseï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™ä¸ä¼šæ’åºã€‚</li><li><code>allow_nan</code>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º Trueã€‚å¦‚æœè®¾ç½®ä¸º Falseï¼Œåˆ™åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ° NaNã€Infinity æˆ– -Infinity ç­‰ç‰¹æ®Šæµ®ç‚¹æ•°å€¼ï¼Œä¼šæŠ›å‡º ValueError å¼‚å¸¸ï¼›å¦‚æœè®¾ç½®ä¸º Trueï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™ä¼šå°†è¿™äº›ç‰¹æ®Šå€¼è½¬æ¢ä¸ºç›¸åº”çš„å­—ç¬¦ä¸²ã€‚</li></ol><p>ä¸èƒ½dumpsçš„ç±»å‹ï¼š</p><ol><li>ä¸å¯åºåˆ—åŒ–çš„å¯¹è±¡ï¼šå¦‚è‡ªå®šä¹‰å¯¹è±¡ã€å‡½æ•°ã€æ–‡ä»¶å¯¹è±¡ç­‰ã€‚<code>json.dumps()</code> å‡½æ•°åªèƒ½åºåˆ—åŒ–æ”¯æŒ JSON æ•°æ®ç±»å‹çš„ Python å¯¹è±¡ï¼ŒåŒ…æ‹¬å­—å…¸ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼å’Œ Noneã€‚å¦åˆ™å¼•å‘ <code>TypeError</code> å¼‚å¸¸ã€‚</li><li>åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼šå¦‚æœè¦åºåˆ—åŒ–çš„å¯¹è±¡åŒ…å«å¾ªç¯å¼•ç”¨ï¼ˆå³å¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼Œå½¢æˆäº†ç¯ï¼‰ï¼Œåˆ™ <code>json.dumps()</code> å‡½æ•°ä¼šæŠ›å‡º ValueError å¼‚å¸¸ã€‚JSON æ ¼å¼ä¸æ”¯æŒå¾ªç¯å¼•ç”¨ï¼Œå› æ­¤æ— æ³•å°†åŒ…å«å¾ªç¯å¼•ç”¨çš„å¯¹è±¡è½¬æ¢ä¸º JSON æ ¼å¼ã€‚</li><li>åŒ…å«ç‰¹æ®Šå€¼çš„æµ®ç‚¹æ•°ï¼šJSON è§„èŒƒä¸­ä¸æ”¯æŒ NaNã€Infinity å’Œ -Infinity ç­‰ç‰¹æ®Šçš„æµ®ç‚¹æ•°å€¼ã€‚å¦‚æœè¦åºåˆ—åŒ–çš„å¯¹è±¡åŒ…å«è¿™äº›ç‰¹æ®Šå€¼ï¼Œåˆ™ä¼šæŠ›å‡º ValueError å¼‚å¸¸ã€‚å¯ä»¥é€šè¿‡å°† <code>allow_nan</code> å‚æ•°è®¾ç½®ä¸º False æ¥ç¦æ­¢åºåˆ—åŒ–ç‰¹æ®Šçš„æµ®ç‚¹æ•°å€¼ï¼Œä½†è¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ JSON ç¼–ç åçš„å­—ç¬¦ä¸²æ— æ³•è¢«æ ‡å‡†çš„ JSON è§£æå™¨è§£æã€‚</li></ol><h2 id="ä»æ–‡ä»¶è¯»å–-JSON-æ•°æ®"><a href="#ä»æ–‡ä»¶è¯»å–-JSON-æ•°æ®" class="headerlink" title="ä»æ–‡ä»¶è¯»å– JSON æ•°æ®"></a>ä»æ–‡ä»¶è¯»å– JSON æ•°æ®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;input_data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    data = json.load(file)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure><h2 id="å°†æ•°æ®å†™å…¥-JSON-æ–‡ä»¶"><a href="#å°†æ•°æ®å†™å…¥-JSON-æ–‡ä»¶" class="headerlink" title="å°†æ•°æ®å†™å…¥ JSON æ–‡ä»¶"></a>å°†æ•°æ®å†™å…¥ JSON æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;å°ç†Šç»´å°¼&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">70</span>, <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;Beijing&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out_data.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    json.dump(data, file)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pymysqlçš„å‡ ç§æ¸¸æ ‡ç±»</title>
      <link href="/2021/05/17/pymysql%E7%9A%84%E5%87%A0%E7%A7%8D%E6%B8%B8%E6%A0%87%E7%B1%BB/"/>
      <url>/2021/05/17/pymysql%E7%9A%84%E5%87%A0%E7%A7%8D%E6%B8%B8%E6%A0%87%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h3 id="é»˜è®¤æ¸¸æ ‡-Cursor"><a href="#é»˜è®¤æ¸¸æ ‡-Cursor" class="headerlink" title="é»˜è®¤æ¸¸æ ‡ Cursor"></a>é»˜è®¤æ¸¸æ ‡ Cursor</h3><p>è¿”å›çš„æŸ¥è¯¢ç»“æœä¸ºå…ƒç»„æ ¼å¼ï¼Œå…¶ä¸­å…ƒç´ çš„é¡ºåºä¸æŸ¥è¯¢ç»“æœçš„åˆ—é¡ºåºä¸€è‡´ã€‚</p><h3 id="å­—å…¸æ¸¸æ ‡-DictCursor"><a href="#å­—å…¸æ¸¸æ ‡-DictCursor" class="headerlink" title="å­—å…¸æ¸¸æ ‡ DictCursor"></a>å­—å…¸æ¸¸æ ‡ DictCursor</h3><p>è¿”å›çš„æŸ¥è¯¢ç»“æœä¸ºå­—å…¸æ ¼å¼ï¼Œå…¶ä¸­é”®æ˜¯åˆ—åï¼Œå€¼æ˜¯å¯¹åº”çš„å­—æ®µå€¼ã€‚</p><p>åœ¨å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶é€šè¿‡ <code>cursorclass</code> å‚æ•°æŒ‡å®šï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql.cursors</span><br><span class="line"></span><br><span class="line">connection = pymysql.connect(</span><br><span class="line">    host=<span class="string">&#x27;your_host&#x27;</span>,</span><br><span class="line">    user=<span class="string">&#x27;your_user&#x27;</span>,</span><br><span class="line">    password=<span class="string">&#x27;your_password&#x27;</span>,</span><br><span class="line">    database=<span class="string">&#x27;your_database&#x27;</span>,</span><br><span class="line">    cursorclass=pymysql.cursors.DictCursor</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mongoåˆ›å»ºç”¨æˆ·å¯†ç </title>
      <link href="/2021/04/18/mongo%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81/"/>
      <url>/2021/04/18/mongo%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>åœ¨<code>admin</code>ä¸­åˆ›å»ºç”¨æˆ·ï¼Œæƒé™ä¸º<code>readWriteAnyDatabase</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.createUser(<span class="punctuation">&#123;</span></span><br><span class="line">  user<span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">  pwd<span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">  roles<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> role<span class="punctuation">:</span> <span class="string">&quot;readWriteAnyDatabase&quot;</span><span class="punctuation">,</span> db<span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®ä¸­å¼€å¯<code>authorization</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mongod.conf</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> mongo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitä¸­forkå’Œcloneçš„åŒºåˆ«</title>
      <link href="/2020/01/02/git%E7%9A%84fork/"/>
      <url>/2020/01/02/git%E7%9A%84fork/</url>
      
        <content type="html"><![CDATA[<h2 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h2><p>å¤åˆ¶ä¸€ä¸ªè¿œç¨‹ä»“åº“åˆ°ä½ è‡ªå·±çš„gitè´¦æˆ·ä¸‹ï¼Œç­‰äºæ‹·è´äº†ä¸€ä¸ªå‰¯æœ¬ã€‚å¯ä»¥éšæ„çš„æäº¤ï¼Œä¸ä¼šå½±å“åˆ°åŸä»“åº“ã€‚</p><h2 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h2><p>å°†ä¸€ä¸ªè¿œç¨‹ä»“åº“è¿æ¥åˆ°æœ¬åœ°è®¡ç®—æœºä¸Šï¼Œä½†å¦‚æœæ²¡æƒé™ï¼Œåªèƒ½pullä¸èƒ½pushã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
